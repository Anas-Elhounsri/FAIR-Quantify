{
  "code_repository": [
    {
      "confidence": 1,
      "result": {
        "type": "Url",
        "value": "https://github.com/QuKunLab/APEC"
      },
      "technique": "GitHub_API"
    }
  ],
  "date_created": [
    {
      "confidence": 1,
      "result": {
        "type": "Date",
        "value": "2018-08-07T07:34:14Z"
      },
      "technique": "GitHub_API"
    }
  ],
  "date_updated": [
    {
      "confidence": 1,
      "result": {
        "type": "Date",
        "value": "2024-01-19T10:41:40Z"
      },
      "technique": "GitHub_API"
    }
  ],
  "description": [
    {
      "confidence": 1,
      "result": {
        "type": "String",
        "value": "Single cell epigenomic clustering based on accessibility pattern"
      },
      "technique": "GitHub_API"
    }
  ],
  "documentation": [
    {
      "confidence": 1,
      "result": {
        "format": "readthedocs",
        "type": "Url",
        "value": "http://bedtools.readthedocs.io/"
      },
      "source": "https://raw.githubusercontent.com/QuKunLab/APEC/master/README.md",
      "technique": "regular_expression"
    }
  ],
  "download_url": [
    {
      "confidence": 1,
      "result": {
        "type": "Url",
        "value": "https://github.com/QuKunLab/APEC/releases"
      },
      "technique": "GitHub_API"
    }
  ],
  "forks_count": [
    {
      "confidence": 1,
      "result": {
        "type": "Number",
        "value": 9
      },
      "technique": "GitHub_API"
    }
  ],
  "forks_url": [
    {
      "confidence": 1,
      "result": {
        "type": "Url",
        "value": "https://api.github.com/repos/QuKunLab/APEC/forks"
      },
      "technique": "GitHub_API"
    }
  ],
  "full_name": [
    {
      "confidence": 1,
      "result": {
        "type": "String",
        "value": "QuKunLab/APEC"
      },
      "technique": "GitHub_API"
    }
  ],
  "full_title": [
    {
      "confidence": 1,
      "result": {
        "type": "String",
        "value": "User Guide for APEC (v1.2.2)"
      },
      "source": "https://raw.githubusercontent.com/QuKunLab/APEC/master/README.md",
      "technique": "regular_expression"
    }
  ],
  "has_script_file": [
    {
      "confidence": 1,
      "result": {
        "type": "Url",
        "value": "https://raw.githubusercontent.com/QuKunLab/APEC/master/code_v1.0.5/APEC_prepare_steps.sh"
      },
      "technique": "file_exploration"
    },
    {
      "confidence": 1,
      "result": {
        "type": "Url",
        "value": "https://raw.githubusercontent.com/QuKunLab/APEC/master/code_v1.0.6/APEC_prepare_steps.sh"
      },
      "technique": "file_exploration"
    },
    {
      "confidence": 1,
      "result": {
        "type": "Url",
        "value": "https://raw.githubusercontent.com/QuKunLab/APEC/master/code_v1.1.0/APEC_prepare_steps.sh"
      },
      "technique": "file_exploration"
    },
    {
      "confidence": 1,
      "result": {
        "type": "Url",
        "value": "https://raw.githubusercontent.com/QuKunLab/APEC/master/code_v1.2/APEC_prepare_steps.sh"
      },
      "technique": "file_exploration"
    }
  ],
  "images": [
    {
      "confidence": 1,
      "result": {
        "type": "Url",
        "value": "https://raw.githubusercontent.com/QuKunLab/APEC/master/images/workflow.jpg"
      },
      "source": "https://raw.githubusercontent.com/QuKunLab/APEC/master/README.md",
      "technique": "regular_expression"
    },
    {
      "confidence": 1,
      "result": {
        "type": "Url",
        "value": "https://raw.githubusercontent.com/QuKunLab/APEC/master/images/TSNE_by_APEC_with_cluster_label.jpg"
      },
      "source": "https://raw.githubusercontent.com/QuKunLab/APEC/master/README.md",
      "technique": "regular_expression"
    },
    {
      "confidence": 1,
      "result": {
        "type": "Url",
        "value": "https://raw.githubusercontent.com/QuKunLab/APEC/master/images/pseudotime_trajectory_with_notes_label.jpg"
      },
      "source": "https://raw.githubusercontent.com/QuKunLab/APEC/master/README.md",
      "technique": "regular_expression"
    },
    {
      "confidence": 1,
      "result": {
        "type": "Url",
        "value": "https://raw.githubusercontent.com/QuKunLab/APEC/master/images/motif_GATA1_on_trajectory_by_APEC.jpg"
      },
      "source": "https://raw.githubusercontent.com/QuKunLab/APEC/master/README.md",
      "technique": "regular_expression"
    }
  ],
  "installation": [
    {
      "confidence": 1,
      "result": {
        "type": "File_dump",
        "value": "\n#### download miniconda\n\n    wget https://repo.anaconda.com/miniconda/Miniconda2-latest-Linux-x86_64.sh\n\n#### install miniconda\n\n    bash Miniconda2-latest-Linux-x86_64.sh\n\n#### set channels, all channels must be arranged in the following order\n\n    conda config --add channels bioconda\n    conda config --add channels r\n    conda config --add channels defaults\n    conda config --add channels conda-forge\n\n#### set a new environment for APEC, i.e. apec_env\n\n    conda create -n apec_env python=2.7\n\n#### install python packages\n\n    conda install -n apec_env bowtie2 samtools bedtools macs2 meme=4.11.2 ucsc-bedgraphtobigwig homer\n\n    conda install -n apec_env numpy scipy=1.0.0 pandas numba pysam matplotlib seaborn setuptools networkx python-louvain=0.11\n    conda install -n apec_env python-Levenshtein scikit-learn=0.20.0 multicore-tsne umap-learn rpy2=2.8.6\n    conda install -n apec_env -c auto multiprocessing\n\n    conda install -n apec_env bioconductor-monocle=2.4.0 (It's not recommended to install monocle with conda)\n    conda install -n apec_env libiconv r-cluster r-stringr=1.2.0  (required if you use conda to install monocle)\n\n**Note**: We found some problems for the R enviroment installed by conda, so we recommend that users do not use conda to install the R environment and Monocle.\n\n**Note**: We also found some problems when installing non-python software via conda/bioconda, so we recommend that users do not use conda/bioconda to install bowtie2, samtools, bedtools, macs2, meme (4.11.2) and bedgraghtobigwig.\n\n#### activate apec_env\n\n    conda activate apec_env\n\n#### install genome reference for Homer\n\n    perl /path-to-homer/configureHomer.pl -install hg19\n    perl /path-to-homer/configureHomer.pl -install mm10\n"
      },
      "source": "https://raw.githubusercontent.com/QuKunLab/APEC/master/Instruction_for_old_versions/Install_by_miniconda.md",
      "technique": "file_exploration"
    },
    {
      "confidence": 1,
      "result": {
        "original_header": "User Guide for APEC (v1.2.2)",
        "type": "Text_excerpt",
        "value": "(Accessibility Pattern based Epigenomic Clustering)\n\n<img src=\"images/workflow.jpg\" width=\"800\">\n\nAPEC can perform fine cell type clustering on single cell chromatin accessibility data from scATAC-seq, snATAC-seq, sciATAC-seq or any other relevant experiment. It can also be used to evaluate gene expression from relevant accesson, search for differential motifs/genes for each cell cluster, find super enhancers, and construct pseudo-time trajectory (by calling Monocle). **If users have already obtained the fragment-count-per-peak matrix from other mapping pipelines (such as CellRanger), please run APEC from [Section One \"Run APEC from fragment count matrix\"](#section-one-run-aepc-from-fragment-count-matrix). If users have only the raw fastq files, please jump to [Section Two \"Get fragment count matrix from raw data\"](#section-two-get-fragment-count-matrix-from-raw-data).**\n"
      },
      "source": "https://raw.githubusercontent.com/QuKunLab/APEC/master/README.md",
      "technique": "header_analysis"
    },
    {
      "confidence": 1,
      "result": {
        "original_header": "1.2 Install and import APEC",
        "parent_header": [
          "User Guide for APEC (v1.2.2)",
          "Section One. Run AEPC from fragment count matrix",
          "1. Requirements and installation"
        ],
        "type": "Text_excerpt",
        "value": "Users can install APEC by:\n\n    pip install APEC==1.2.2\n\nWe strongly recommend that users build a python 3.6.8 environment for APEC with **miniconda** or **anaconda**, since APEC is dependent on specific versions of python packages (see README.md in examples folder), and Monocle (2.10.0) can be installed in conda environment too. The commands to create a conda environment (named as apec_env) and install APEC and Monocle are:\n\n    conda create -n apec_env python=3.6.8\n    conda activate apec_env\n    pip install cmake==3.18.4\n    pip install APEC==1.2.2\n    conda install -n apec_env -c bioconda bioconductor-monocle=2.10.0\n\nIn Ipython, Jupyter-notebook or a python script, users can import packages of APEC by:\n\n    from APEC import clustering,plot,generate\n\nUsers can inquire the manual for each function of APEC by using \"help()\" in Ipython or Jupyter, for example:\n\n    help(clustering.cluster_byAccesson)\n"
      },
      "source": "https://raw.githubusercontent.com/QuKunLab/APEC/master/README.md",
      "technique": "header_analysis"
    },
    {
      "confidence": 1,
      "result": {
        "original_header": "2. Input data",
        "parent_header": [
          "User Guide for APEC (v1.2.2)",
          "Section One. Run AEPC from fragment count matrix"
        ],
        "type": "Text_excerpt",
        "value": "If users have employed APEC to generate fragment count matrix from raw data (see [Section Two](#section-two-get-fragment-count-matrix-from-raw-data)), they can run AEPC clustering and subsequent analysis on the $project folder directly.\n\nIf using APEC for 10X scATAC-seq data, users can run the following script to prepare the project:\n\n    from APEC import convert\n    convert.convert_10X('$10X_data_folder/', '$project/')\n\nThe '$10X_data_folder' should contain 'barcodes.tsv', 'matrix.mtx' and 'peaks.bed' files, which are the results of Cellranger.\n\nIf using the matrix generated from other experiments, users need to prepare a project folder (termed '$project'), which contains **matrix** and **peak** folders. Please place \"filtered_cells.csv\" and \"filtered_reads.mtx\" in **matrix** folder, \"top_filtered_peaks.bed\" in **peak** folder. Here is the instruction for three input files:\n\n    filtered_cells.csv: Two-column (separated by tabs) list of cell information ('name' and 'notes'):\n                        The 'name' column stores cell names (or barcodes).\n                        The 'notes' column can be cell-type or any other cell information.\n    top_filtered_peaks.bed: Three-column list of peaks, which is a standard bed format file.\n                            It is same to the \"peaks.bed\" file in the CellRanger output of a 10X dataset.\n    filtered_reads.mtx: Fragment count matrix in mtx format, where a row is a peak and a column is a cell.\n                        It is same to the \"matrix.mtx\" file in the CellRanger output of a 10X dataset.\n                        The order of cells should be the same with \"filtered_cells.csv\".\n                        The order of peaks should be the same with \"top_filtered_peaks.bed.\n\n"
      },
      "source": "https://raw.githubusercontent.com/QuKunLab/APEC/master/README.md",
      "technique": "header_analysis"
    },
    {
      "confidence": 1,
      "result": {
        "original_header": "3.1 Clustering by APEC",
        "parent_header": [
          "User Guide for APEC (v1.2.2)",
          "Section One. Run AEPC from fragment count matrix",
          "3. Functions of APEC (step by step)"
        ],
        "type": "Text_excerpt",
        "value": "Use the following codes to cluster cells by APEC algorithm:\n\n    clustering.build_accesson('$project', ngroup=600)\n    clustering.cluster_byAccesson('$project', nc=0, norm='probability')\n    plot.plot_tsne('$project', rs=0)\n    plot.correlation('$project', cell_label='notes', clip=[0,1])\n\ninput parameters:\n\n    ngroup:   Number of accessons, default=600.\n    nc:       Number of cell clusters, set it to 0 if users want to predict it with APEC, default=0.\n    norm:     Normalization method, can be 'zscore', 'probability', or 'filter'; default='probability'.\n              If there are many noises in the fragment count matrix, please consider to set norm='filter'.\n    rs:             The random_seed parameter for tSNE, default=0.\n    cell_label:     Color labels for cells, can be 'notes' or 'cluster', default='notes'.\n                    If cell_label='cluster', it will use clustering result of clustering.cluster_byAccesson().\n    clip:           Range [min, max] for the correlation heatmap, default=[-1,1]\n\noutput files:\n\n    $project/matrix/Accesson_peaks.csv\n    $project/matrix/Accesson_reads.csv\n    $project/result/cluster_by_APEC.csv\n    $project/result/TSNE_by_APEC.csv\n    $project/figure/TSNE_by_APEC_with_notes_label.pdf\n    $project/figure/TSNE_by_APEC_with_cluster_label.pdf\n    $project/figure/cell_cell_correlation_by_APEC_with_notes_label.png\n\n<img src=\"images/TSNE_by_APEC_with_notes_label.jpg\" width=\"400\">\n\n_Figure A. TSNE_by_APEC_with_notes_label.pdf, where cells are labeled with cell types (the 'notes' column of filtered_cells.csv)_\n\n<img src=\"images/TSNE_by_APEC_with_cluster_label.jpg\" width=\"400\">\n\n_Figure B. TSNE_by_APEC_with_cluster_label.pdf, where cells are labeled with cell clusters (the 'cluster' column of cluster_by_APEC.csv)_\n"
      },
      "source": "https://raw.githubusercontent.com/QuKunLab/APEC/master/README.md",
      "technique": "header_analysis"
    },
    {
      "confidence": 1,
      "result": {
        "original_header": "3.2 Clustering by chromVAR (optional, required for motif analysis)",
        "parent_header": [
          "User Guide for APEC (v1.2.2)",
          "Section One. Run AEPC from fragment count matrix",
          "3. Functions of APEC (step by step)"
        ],
        "type": "Text_excerpt",
        "value": "Use the following codes to cluster cells by chromVAR algorithm:\n\n    generate.motif_matrix('$project', genome_fa='$reference/hg19_chr.fa',\n                          background='$reference/tier1_markov1.norc.txt',\n                          meme='$reference/JASPAR2018_CORE_vertebrates_redundant_pfms_meme.txt',\n                          np=4)\n    clustering.cluster_byMotif('$project', np=4, nc=0, ns=50)\n\ninput parameters:\n\n    genome_fa:   Path to hg19_chr.fa or mm10_chr.fa in $reference folder.\n    background:  Path to tier1_markov1.norc.txt in $reference folder.\n    meme:        Path to JASPAR2018_CORE_vertebrates_redundant_pfms_meme.txt in $reference folder.\n    np:          Number of CPU cores used for parallel calculation, default=4.\n    nc:          Number of cell clusters, set it to 0 if users want to predict it using Louvain algorithm, default=0.\n    ns:          Number of permuted sampling, default=50.\n\noutput files:\n\n    $project/result/deviation_chromVAR.csv\n    $project/result/cluster_by_chromVAR.csv\n"
      },
      "source": "https://raw.githubusercontent.com/QuKunLab/APEC/master/README.md",
      "technique": "header_analysis"
    },
    {
      "confidence": 1,
      "result": {
        "original_header": "3.3 Evaluate ARI, NMI and AMI for clustering result",
        "parent_header": [
          "User Guide for APEC (v1.2.2)",
          "Section One. Run AEPC from fragment count matrix",
          "3. Functions of APEC (step by step)"
        ],
        "type": "Text_excerpt",
        "value": "If users have the real cell type in the 'notes' column of '$project/matrix/filtered_cells.csv', please use the following code to calculate ARI, NMI and AMI to estimate the accuracy of the clustering algorithm.\n\n    clustering.cluster_comparison('$project/matrix/filtered_cells.csv',\n                                  '$project/result/cluster_by_APEC.csv',\n                                  exclude='UNK')\n\nThe output ARI, NMI and AMI values will be printed on the screen directly. Please make sure that the column 'notes' of filtered_cells.csv denotes the cell type of each cell. For some datasets, such as the hematopoietic cells, the user should exclude all \"UNK\" cells (unknown type) before the calculation of ARI.\n"
      },
      "source": "https://raw.githubusercontent.com/QuKunLab/APEC/master/README.md",
      "technique": "header_analysis"
    },
    {
      "confidence": 1,
      "result": {
        "original_header": "3.4 Generate pseudotime trajectory",
        "parent_header": [
          "User Guide for APEC (v1.2.2)",
          "Section One. Run AEPC from fragment count matrix",
          "3. Functions of APEC (step by step)"
        ],
        "type": "Text_excerpt",
        "value": "By default, APEC adapts monocle to generate pseudotime trajectory from accesson matrix:\n\n    generate.monocle_trajectory('$project', npc=5)\n    plot.plot_trajectory('$project', cell_label='notes', angles=[30,30])\n\ninput parameters:\n\n    npc:            Number of principal components used to build trajectory, default=5.\n    cell_label:     Labels for cells, can be 'notes' or 'cluster', default='notes'.\n    angles:         Rotation angles for 3D trajectory, e.g. [100,20], default=[30,30].\n\noutput files:\n\n    $project/result/monocle_trajectory.csv\n    $project/result/monocle_reduced_dimension.csv\n    $project/figure/pseudotime_trajectory_with_notes_label.pdf\n\n<img src=\"images/pseudotime_trajectory_with_notes_label.jpg\" width=\"400\">\n\n_Figure C. pseudotime_trajectory_with_notes_label.pdf_\n"
      },
      "source": "https://raw.githubusercontent.com/QuKunLab/APEC/master/README.md",
      "technique": "header_analysis"
    },
    {
      "confidence": 1,
      "result": {
        "original_header": "3.5 Generate gene expression",
        "parent_header": [
          "User Guide for APEC (v1.2.2)",
          "Section One. Run AEPC from fragment count matrix",
          "3. Functions of APEC (step by step)"
        ],
        "type": "Text_excerpt",
        "value": "    generate.gene_score('$project', genome_gtf='hg19_RefSeq_genes.gtf', distal=20000)\n\noutput file:\n\n    $project/matrix/genes_scored_by_TSS_peaks.csv\n    $project/peak/genes_TSS_peaks.csv\n"
      },
      "source": "https://raw.githubusercontent.com/QuKunLab/APEC/master/README.md",
      "technique": "header_analysis"
    },
    {
      "confidence": 1,
      "result": {
        "original_header": "3.6 Generate differential feature for a cell cluster",
        "parent_header": [
          "User Guide for APEC (v1.2.2)",
          "Section One. Run AEPC from fragment count matrix",
          "3. Functions of APEC (step by step)"
        ],
        "type": "Text_excerpt",
        "value": "Get differential accessons:\n\n    generate.get_nearby_genes('$project')   # optional. Users should run step 3.5 before this.\n    generate.differential_feature('$project', feature='accesson', target='0', vs='all')\n\nGet differential motifs/genes:\n\n    generate.differential_feature('$project', feature='motif', target='0', vs='all')\n    generate.differential_feature('$project', feature='gene', target='0', vs='all')\n\ninput parameters:\n\n    feature:     Type of feature, can be 'accesson' or 'motif' or 'gene', default='accesson'.\n                 If feature='accesson', run step 3.1 first;\n                 if feature='motif', run step 3.2 first;\n                 if feature='gene', run step 3.5 first.\n    cell_label:  Cell Labels used for differential analysis, can be 'notes' or 'cluster', default='cluster'.\n    target:      The target cluster that users search for differential features, default='1'.\n                 If cell_label='cluster', target is one element in the 'cluster' column of cluster_by_APEC.csv file;\n                 if cell_label='notes', target is one element in the 'notes' column of filtered_cells.csv file.\n    vs:          Versus which clusters, can be '2,3,4' or 'all', default='all' (means all the rest clusters).\n    pvalue:      P-value for student-t test, default=0.01.\n    log2_fold:   Cutoff for log2(fold_change), default=1.\n\noutput file:\n\n    $project/result/differential_accesson_of_cluster_X_vs_XXX.csv\n    $project/result/differential_motif_of_cluster_X_vs_XXX.csv\n    $project/result/differential_gene_of_cluster_X_vs_XXX.csv\n"
      },
      "source": "https://raw.githubusercontent.com/QuKunLab/APEC/master/README.md",
      "technique": "header_analysis"
    },
    {
      "confidence": 1,
      "result": {
        "original_header": "3.7 Plot motif/gene on tSNE/trajectory diagram",
        "parent_header": [
          "User Guide for APEC (v1.2.2)",
          "Section One. Run AEPC from fragment count matrix",
          "3. Functions of APEC (step by step)"
        ],
        "type": "Text_excerpt",
        "value": "    plot.plot_feature('$project', space='tsne', feature='gene', name='FOXO1')\n    plot.plot_feature('$project', space='trajectory', feature='motif', name='GATA1')\n\ninput parameters:\n\n    space:          In which space we draw the feature, can be 'tsne' or 'trajectory', default='tsne'.\n                    If space='tsne', run plot.plot_tsne() first;\n                    if space='trajectory', run step 3.4 first.\n    feature:        Type of the feature, can be 'accesson' or 'motif' or 'gene', default='accesson'.\n                    If feature='accesson', run step 3.1 first;\n                    if feature='motif', run step 3.2 first;\n                    if feature='gene', run step 3.5 first.\n    name:           Name of the feature.\n                    If feature='accesson', name=accesson number, i.e. '1';\n                    if feature='motif', name=motif symbol, i.e. 'GATA1';\n                    if feature='gene', name=gene symbol, i.e. 'CD36'.\n    clip:           Clip range for the input matrix, can be [min, max] or 'none', default='none'.\n    angles:         Rotation angles for 3D trajectory, e.g. [100,20], default=[30,30].\n\noutput files:\n\n    $project/figure/motif_XXX_on_trajectory_by_APEC.pdf\n    $project/figure/gene_XXX_on_tsne_by_APEC.pdf\n\n<img src=\"images/motif_GATA1_on_trajectory_by_APEC.jpg\" width=\"400\">\n\n_Figure D. motif_GATA1_on_trajectory_by_APEC.pdf_\n"
      },
      "source": "https://raw.githubusercontent.com/QuKunLab/APEC/master/README.md",
      "technique": "header_analysis"
    },
    {
      "confidence": 1,
      "result": {
        "original_header": "3.8 Generate potential super enhancer",
        "parent_header": [
          "User Guide for APEC (v1.2.2)",
          "Section One. Run AEPC from fragment count matrix",
          "3. Functions of APEC (step by step)"
        ],
        "type": "Text_excerpt",
        "value": "    generate.super_enhancer('$project', super_range=1000000, p_cutoff=0.01)\n\ninput parameter:\n\n    super_range:    Genome range to search for super enhancer, default=1000000.\n    p_cutoff:       Cutoff of P-value, default=0.01.\n\noutput file:\n\n    $project/result/potential_super_enhancer.csv\n\n"
      },
      "source": "https://raw.githubusercontent.com/QuKunLab/APEC/master/README.md",
      "technique": "header_analysis"
    },
    {
      "confidence": 1,
      "result": {
        "original_header": "1.2    Installation",
        "parent_header": [
          "User Guide for APEC (v1.2.2)",
          "Section Two. Get fragment count matrix from raw data",
          "1. Requirements and installation"
        ],
        "type": "Text_excerpt",
        "value": "# User Guide for APEC (v1.2.2)\n\n(Accessibility Pattern based Epigenomic Clustering)\n\n<img src=\"images/workflow.jpg\" width=\"800\">\n\nAPEC can perform fine cell type clustering on single cell chromatin accessibility data from scATAC-seq, snATAC-seq, sciATAC-seq or any other relevant experiment. It can also be used to evaluate gene expression from relevant accesson, search for differential motifs/genes for each cell cluster, find super enhancers, and construct pseudo-time trajectory (by calling Monocle). **If users have already obtained the fragment-count-per-peak matrix from other mapping pipelines (such as CellRanger), please run APEC from [Section One \"Run APEC from fragment count matrix\"](#section-one-run-aepc-from-fragment-count-matrix). If users have only the raw fastq files, please jump to [Section Two \"Get fragment count matrix from raw data\"](#section-two-get-fragment-count-matrix-from-raw-data).**\n\n## Section One. Run AEPC from fragment count matrix\n\n### 1. Requirements and installation\n\n#### 1.1 Requirements\n\nAPEC requires Linux system (CentOS 7.3+ or Ubuntu 16.04+), as well as Python3 (3.6.8, not 3.7.x) and R (3.5.1+) environments. If users want to build pseudotime trajectory with APEC, please install Monocle (2.10.0, http://cole-trapnell-lab.github.io/monocle-release/docs/) in R (see [1.2 Install and import APEC](#12-install-and-import-apec)). Also, the following softwares are required for APEC if users want to run motif analysis (as chromVAR):\n\n    Bedtools: http://bedtools.readthedocs.io/en/latest/content/installation.html\n    Meme 4.11.2: http://meme-suite.org/doc/download.html?man_type=web (Meme 5.x.x is not compatible with APEC)\n\nThe files in **reference** folder are required for APEC. But we didn't upload reference files to GitHub since they are too big. Users can download all reference files from one of the following websites:\n\n-|website\n-|-\n1|http://galaxy.ustc.edu.cn:30803/APEC/reference/ <br> Due to server upgrades, this site will be temporarily unavailable from 2020-03-30 to 2020-04-01.\n2|https://apec.oss-us-east-1.aliyuncs.com/APEC/reference/reference.zip\n3|https://drive.google.com/drive/folders/1psK7za4KNJfqpigUaLMY3bWlqBHp1J5k?usp=sharing\n\nThe **reference** folder should contains the following files:\n\n    hg19_RefSeq_genes.gtf, hg19_chr.fa, hg19_chr.fa.fai,\n    mm10_RefSeq_genes.gtf, mm10_chr.fa, mm10_chr.fa.fai,\n    JASPAR2018_CORE_vertebrates_non-redundant_pfms_meme.txt, tier1_markov1.norc.txt\n\n#### 1.2 Install and import APEC\n\nUsers can install APEC by:\n\n    pip install APEC==1.2.2\n\nWe strongly recommend that users build a python 3.6.8 environment for APEC with **miniconda** or **anaconda**, since APEC is dependent on specific versions of python packages (see README.md in examples folder), and Monocle (2.10.0) can be installed in conda environment too. The commands to create a conda environment (named as apec_env) and install APEC and Monocle are:\n\n    conda create -n apec_env python=3.6.8\n    conda activate apec_env\n    pip install cmake==3.18.4\n    pip install APEC==1.2.2\n    conda install -n apec_env -c bioconda bioconductor-monocle=2.10.0\n\nIn Ipython, Jupyter-notebook or a python script, users can import packages of APEC by:\n\n    from APEC import clustering,plot,generate\n\nUsers can inquire the manual for each function of APEC by using \"help()\" in Ipython or Jupyter, for example:\n\n    help(clustering.cluster_byAccesson)\n\n### 2. Input data\n\nIf users have employed APEC to generate fragment count matrix from raw data (see [Section Two](#section-two-get-fragment-count-matrix-from-raw-data)), they can run AEPC clustering and subsequent analysis on the $project folder directly.\n\nIf using APEC for 10X scATAC-seq data, users can run the following script to prepare the project:\n\n    from APEC import convert\n    convert.convert_10X('$10X_data_folder/', '$project/')\n\nThe '$10X_data_folder' should contain 'barcodes.tsv', 'matrix.mtx' and 'peaks.bed' files, which are the results of Cellranger.\n\nIf using the matrix generated from other experiments, users need to prepare a project folder (termed '$project'), which contains **matrix** and **peak** folders. Please place \"filtered_cells.csv\" and \"filtered_reads.mtx\" in **matrix** folder, \"top_filtered_peaks.bed\" in **peak** folder. Here is the instruction for three input files:\n\n    filtered_cells.csv: Two-column (separated by tabs) list of cell information ('name' and 'notes'):\n                        The 'name' column stores cell names (or barcodes).\n                        The 'notes' column can be cell-type or any other cell information.\n    top_filtered_peaks.bed: Three-column list of peaks, which is a standard bed format file.\n                            It is same to the \"peaks.bed\" file in the CellRanger output of a 10X dataset.\n    filtered_reads.mtx: Fragment count matrix in mtx format, where a row is a peak and a column is a cell.\n                        It is same to the \"matrix.mtx\" file in the CellRanger output of a 10X dataset.\n                        The order of cells should be the same with \"filtered_cells.csv\".\n                        The order of peaks should be the same with \"top_filtered_peaks.bed.\n\n\n### 3. Functions of APEC (step by step)\n\n#### Users can directly run example projects and scripts in \"examples\" folder to generate figures listed in our APEC paper (https://www.biorxiv.org/content/10.1101/646331v4).\n\n#### 3.1 Clustering by APEC\n\nUse the following codes to cluster cells by APEC algorithm:\n\n    clustering.build_accesson('$project', ngroup=600)\n    clustering.cluster_byAccesson('$project', nc=0, norm='probability')\n    plot.plot_tsne('$project', rs=0)\n    plot.correlation('$project', cell_label='notes', clip=[0,1])\n\ninput parameters:\n\n    ngroup:   Number of accessons, default=600.\n    nc:       Number of cell clusters, set it to 0 if users want to predict it with APEC, default=0.\n    norm:     Normalization method, can be 'zscore', 'probability', or 'filter'; default='probability'.\n              If there are many noises in the fragment count matrix, please consider to set norm='filter'.\n    rs:             The random_seed parameter for tSNE, default=0.\n    cell_label:     Color labels for cells, can be 'notes' or 'cluster', default='notes'.\n                    If cell_label='cluster', it will use clustering result of clustering.cluster_byAccesson().\n    clip:           Range [min, max] for the correlation heatmap, default=[-1,1]\n\noutput files:\n\n    $project/matrix/Accesson_peaks.csv\n    $project/matrix/Accesson_reads.csv\n    $project/result/cluster_by_APEC.csv\n    $project/result/TSNE_by_APEC.csv\n    $project/figure/TSNE_by_APEC_with_notes_label.pdf\n    $project/figure/TSNE_by_APEC_with_cluster_label.pdf\n    $project/figure/cell_cell_correlation_by_APEC_with_notes_label.png\n\n<img src=\"images/TSNE_by_APEC_with_notes_label.jpg\" width=\"400\">\n\n_Figure A. TSNE_by_APEC_with_notes_label.pdf, where cells are labeled with cell types (the 'notes' column of filtered_cells.csv)_\n\n<img src=\"images/TSNE_by_APEC_with_cluster_label.jpg\" width=\"400\">\n\n_Figure B. TSNE_by_APEC_with_cluster_label.pdf, where cells are labeled with cell clusters (the 'cluster' column of cluster_by_APEC.csv)_\n\n#### 3.2 Clustering by chromVAR (optional, required for motif analysis)\n\nUse the following codes to cluster cells by chromVAR algorithm:\n\n    generate.motif_matrix('$project', genome_fa='$reference/hg19_chr.fa',\n                          background='$reference/tier1_markov1.norc.txt',\n                          meme='$reference/JASPAR2018_CORE_vertebrates_redundant_pfms_meme.txt',\n                          np=4)\n    clustering.cluster_byMotif('$project', np=4, nc=0, ns=50)\n\ninput parameters:\n\n    genome_fa:   Path to hg19_chr.fa or mm10_chr.fa in $reference folder.\n    background:  Path to tier1_markov1.norc.txt in $reference folder.\n    meme:        Path to JASPAR2018_CORE_vertebrates_redundant_pfms_meme.txt in $reference folder.\n    np:          Number of CPU cores used for parallel calculation, default=4.\n    nc:          Number of cell clusters, set it to 0 if users want to predict it using Louvain algorithm, default=0.\n    ns:          Number of permuted sampling, default=50.\n\noutput files:\n\n    $project/result/deviation_chromVAR.csv\n    $project/result/cluster_by_chromVAR.csv\n\n#### 3.3 Evaluate ARI, NMI and AMI for clustering result\n\nIf users have the real cell type in the 'notes' column of '$project/matrix/filtered_cells.csv', please use the following code to calculate ARI, NMI and AMI to estimate the accuracy of the clustering algorithm.\n\n    clustering.cluster_comparison('$project/matrix/filtered_cells.csv',\n                                  '$project/result/cluster_by_APEC.csv',\n                                  exclude='UNK')\n\nThe output ARI, NMI and AMI values will be printed on the screen directly. Please make sure that the column 'notes' of filtered_cells.csv denotes the cell type of each cell. For some datasets, such as the hematopoietic cells, the user should exclude all \"UNK\" cells (unknown type) before the calculation of ARI.\n\n#### 3.4 Generate pseudotime trajectory\n\nBy default, APEC adapts monocle to generate pseudotime trajectory from accesson matrix:\n\n    generate.monocle_trajectory('$project', npc=5)\n    plot.plot_trajectory('$project', cell_label='notes', angles=[30,30])\n\ninput parameters:\n\n    npc:            Number of principal components used to build trajectory, default=5.\n    cell_label:     Labels for cells, can be 'notes' or 'cluster', default='notes'.\n    angles:         Rotation angles for 3D trajectory, e.g. [100,20], default=[30,30].\n\noutput files:\n\n    $project/result/monocle_trajectory.csv\n    $project/result/monocle_reduced_dimension.csv\n    $project/figure/pseudotime_trajectory_with_notes_label.pdf\n\n<img src=\"images/pseudotime_trajectory_with_notes_label.jpg\" width=\"400\">\n\n_Figure C. pseudotime_trajectory_with_notes_label.pdf_\n\n#### 3.5 Generate gene expression\n\n    generate.gene_score('$project', genome_gtf='hg19_RefSeq_genes.gtf', distal=20000)\n\noutput file:\n\n    $project/matrix/genes_scored_by_TSS_peaks.csv\n    $project/peak/genes_TSS_peaks.csv\n\n#### 3.6 Generate differential feature for a cell cluster\n\nGet differential accessons:\n\n    generate.get_nearby_genes('$project')   # optional. Users should run step 3.5 before this.\n    generate.differential_feature('$project', feature='accesson', target='0', vs='all')\n\nGet differential motifs/genes:\n\n    generate.differential_feature('$project', feature='motif', target='0', vs='all')\n    generate.differential_feature('$project', feature='gene', target='0', vs='all')\n\ninput parameters:\n\n    feature:     Type of feature, can be 'accesson' or 'motif' or 'gene', default='accesson'.\n                 If feature='accesson', run step 3.1 first;\n                 if feature='motif', run step 3.2 first;\n                 if feature='gene', run step 3.5 first.\n    cell_label:  Cell Labels used for differential analysis, can be 'notes' or 'cluster', default='cluster'.\n    target:      The target cluster that users search for differential features, default='1'.\n                 If cell_label='cluster', target is one element in the 'cluster' column of cluster_by_APEC.csv file;\n                 if cell_label='notes', target is one element in the 'notes' column of filtered_cells.csv file.\n    vs:          Versus which clusters, can be '2,3,4' or 'all', default='all' (means all the rest clusters).\n    pvalue:      P-value for student-t test, default=0.01.\n    log2_fold:   Cutoff for log2(fold_change), default=1.\n\noutput file:\n\n    $project/result/differential_accesson_of_cluster_X_vs_XXX.csv\n    $project/result/differential_motif_of_cluster_X_vs_XXX.csv\n    $project/result/differential_gene_of_cluster_X_vs_XXX.csv\n\n#### 3.7 Plot motif/gene on tSNE/trajectory diagram\n\n    plot.plot_feature('$project', space='tsne', feature='gene', name='FOXO1')\n    plot.plot_feature('$project', space='trajectory', feature='motif', name='GATA1')\n\ninput parameters:\n\n    space:          In which space we draw the feature, can be 'tsne' or 'trajectory', default='tsne'.\n                    If space='tsne', run plot.plot_tsne() first;\n                    if space='trajectory', run step 3.4 first.\n    feature:        Type of the feature, can be 'accesson' or 'motif' or 'gene', default='accesson'.\n                    If feature='accesson', run step 3.1 first;\n                    if feature='motif', run step 3.2 first;\n                    if feature='gene', run step 3.5 first.\n    name:           Name of the feature.\n                    If feature='accesson', name=accesson number, i.e. '1';\n                    if feature='motif', name=motif symbol, i.e. 'GATA1';\n                    if feature='gene', name=gene symbol, i.e. 'CD36'.\n    clip:           Clip range for the input matrix, can be [min, max] or 'none', default='none'.\n    angles:         Rotation angles for 3D trajectory, e.g. [100,20], default=[30,30].\n\noutput files:\n\n    $project/figure/motif_XXX_on_trajectory_by_APEC.pdf\n    $project/figure/gene_XXX_on_tsne_by_APEC.pdf\n\n<img src=\"images/motif_GATA1_on_trajectory_by_APEC.jpg\" width=\"400\">\n\n_Figure D. motif_GATA1_on_trajectory_by_APEC.pdf_\n\n#### 3.8 Generate potential super enhancer\n\n    generate.super_enhancer('$project', super_range=1000000, p_cutoff=0.01)\n\ninput parameter:\n\n    super_range:    Genome range to search for super enhancer, default=1000000.\n    p_cutoff:       Cutoff of P-value, default=0.01.\n\noutput file:\n\n    $project/result/potential_super_enhancer.csv\n\n\n## Section Two. Get fragment count matrix from raw data\n### (This part is only available on GitHub:https://github.com/QuKunLab/APEC)\n\n### 1. Requirements and installation\n\nAll of the following software needs to be placed in the global environment of the Linux system to ensure that they can be called in any path/folder. Picard is also required, but we have placed it into $APEC/reference folder, and users don't need to install it. We recommend that users adopt the latest version of these software, except Meme (version 4.11.2).\n\n    Bowtie2: https://sourceforge.net/projects/bowtie-bio/files/bowtie2/2.2.9/\n    Samtools: https://github.com/samtools/samtools\n    Bedtools: http://bedtools.readthedocs.io/en/latest/content/installation.html\n    Macs2: https://github.com/taoliu/MACS.git\n    Meme 4.11.2: http://meme-suite.org/doc/download.html?man_type=web\n    pysam for python: set up by \"pip install pysam\"\n    Levenshtein for python: set up by \"pip install python-Levenshtein\"\n\n#### 1.2\tInstallation\n\nUsers can simply install this part by copying the **code_v1.2** folder and **reference** folder into a same path. Users **must** run ***APEC_prepare_steps.sh*** directly in code_v1.2/, since each program will invoke the reference files automatically. The **reference** folder is required, but we didn't upload reference files to GitHub since they are too big. Users can download all reference files from one of the following sites:\n\n-|website\n-|-\n1|http://galaxy.ustc.edu.cn:30803/APEC/reference/ <br> Due to server upgrades, this site will be temporarily unavailable from 2020-03-30 to 2020-04-01.\n2|https://apec.oss-us-east-1.aliyuncs.com/APEC/reference_full.zip.001 <br> https://apec.oss-us-east-1.aliyuncs.com/APEC/reference_full.zip.002 <br> https://apec.oss-us-east-1.aliyuncs.com/APEC/reference_full.zip.003\n\n The **reference** folder should contains the following files:\n\n    hg19_refseq_genes_TSS.txt, hg19_RefSeq_genes.gtf, hg19_blacklist.JDB.bed,\n    hg19_chr.fa, hg19_chr.fa.fai, hg19.chrom.sizes,\n    hg19.1.bt2, hg19.2.bt2, hg19.3.bt2, hg19.4.bt2, hg19.rev.1.bt2, hg19.rev.2.bt2,\n    mm10_refseq_genes_TSS.txt, mm10_RefSeq_genes.gtf, mm10_blacklist.BIN.bed,\n    mm10_chr.fa, mm10_chr.fa.fai, mm10.chrom.sizes,\n    mm10.1.bt2, mm10.2.bt2, mm10.3.bt2, mm10.4.bt2, mm10.rev.1.bt2, mm10.rev.2.bt2,\n    JASPAR2018_CORE_vertebrates_non-redundant_pfms_meme.txt, tier1_markov1.norc.txt, picard.jar\n"
      },
      "source": "https://raw.githubusercontent.com/QuKunLab/APEC/master/README.md",
      "technique": "header_analysis"
    },
    {
      "confidence": 1,
      "result": {
        "original_header": "2.1    Arrangement of raw data",
        "parent_header": [
          "User Guide for APEC (v1.2.2)",
          "Section Two. Get fragment count matrix from raw data",
          "2. Fragment count matrix"
        ],
        "type": "Text_excerpt",
        "value": "# User Guide for APEC (v1.2.2)\n\n(Accessibility Pattern based Epigenomic Clustering)\n\n<img src=\"images/workflow.jpg\" width=\"800\">\n\nAPEC can perform fine cell type clustering on single cell chromatin accessibility data from scATAC-seq, snATAC-seq, sciATAC-seq or any other relevant experiment. It can also be used to evaluate gene expression from relevant accesson, search for differential motifs/genes for each cell cluster, find super enhancers, and construct pseudo-time trajectory (by calling Monocle). **If users have already obtained the fragment-count-per-peak matrix from other mapping pipelines (such as CellRanger), please run APEC from [Section One \"Run APEC from fragment count matrix\"](#section-one-run-aepc-from-fragment-count-matrix). If users have only the raw fastq files, please jump to [Section Two \"Get fragment count matrix from raw data\"](#section-two-get-fragment-count-matrix-from-raw-data).**\n\n## Section One. Run AEPC from fragment count matrix\n\n### 1. Requirements and installation\n\n#### 1.1 Requirements\n\nAPEC requires Linux system (CentOS 7.3+ or Ubuntu 16.04+), as well as Python3 (3.6.8, not 3.7.x) and R (3.5.1+) environments. If users want to build pseudotime trajectory with APEC, please install Monocle (2.10.0, http://cole-trapnell-lab.github.io/monocle-release/docs/) in R (see [1.2 Install and import APEC](#12-install-and-import-apec)). Also, the following softwares are required for APEC if users want to run motif analysis (as chromVAR):\n\n    Bedtools: http://bedtools.readthedocs.io/en/latest/content/installation.html\n    Meme 4.11.2: http://meme-suite.org/doc/download.html?man_type=web (Meme 5.x.x is not compatible with APEC)\n\nThe files in **reference** folder are required for APEC. But we didn't upload reference files to GitHub since they are too big. Users can download all reference files from one of the following websites:\n\n-|website\n-|-\n1|http://galaxy.ustc.edu.cn:30803/APEC/reference/ <br> Due to server upgrades, this site will be temporarily unavailable from 2020-03-30 to 2020-04-01.\n2|https://apec.oss-us-east-1.aliyuncs.com/APEC/reference/reference.zip\n3|https://drive.google.com/drive/folders/1psK7za4KNJfqpigUaLMY3bWlqBHp1J5k?usp=sharing\n\nThe **reference** folder should contains the following files:\n\n    hg19_RefSeq_genes.gtf, hg19_chr.fa, hg19_chr.fa.fai,\n    mm10_RefSeq_genes.gtf, mm10_chr.fa, mm10_chr.fa.fai,\n    JASPAR2018_CORE_vertebrates_non-redundant_pfms_meme.txt, tier1_markov1.norc.txt\n\n#### 1.2 Install and import APEC\n\nUsers can install APEC by:\n\n    pip install APEC==1.2.2\n\nWe strongly recommend that users build a python 3.6.8 environment for APEC with **miniconda** or **anaconda**, since APEC is dependent on specific versions of python packages (see README.md in examples folder), and Monocle (2.10.0) can be installed in conda environment too. The commands to create a conda environment (named as apec_env) and install APEC and Monocle are:\n\n    conda create -n apec_env python=3.6.8\n    conda activate apec_env\n    pip install cmake==3.18.4\n    pip install APEC==1.2.2\n    conda install -n apec_env -c bioconda bioconductor-monocle=2.10.0\n\nIn Ipython, Jupyter-notebook or a python script, users can import packages of APEC by:\n\n    from APEC import clustering,plot,generate\n\nUsers can inquire the manual for each function of APEC by using \"help()\" in Ipython or Jupyter, for example:\n\n    help(clustering.cluster_byAccesson)\n\n### 2. Input data\n\nIf users have employed APEC to generate fragment count matrix from raw data (see [Section Two](#section-two-get-fragment-count-matrix-from-raw-data)), they can run AEPC clustering and subsequent analysis on the $project folder directly.\n\nIf using APEC for 10X scATAC-seq data, users can run the following script to prepare the project:\n\n    from APEC import convert\n    convert.convert_10X('$10X_data_folder/', '$project/')\n\nThe '$10X_data_folder' should contain 'barcodes.tsv', 'matrix.mtx' and 'peaks.bed' files, which are the results of Cellranger.\n\nIf using the matrix generated from other experiments, users need to prepare a project folder (termed '$project'), which contains **matrix** and **peak** folders. Please place \"filtered_cells.csv\" and \"filtered_reads.mtx\" in **matrix** folder, \"top_filtered_peaks.bed\" in **peak** folder. Here is the instruction for three input files:\n\n    filtered_cells.csv: Two-column (separated by tabs) list of cell information ('name' and 'notes'):\n                        The 'name' column stores cell names (or barcodes).\n                        The 'notes' column can be cell-type or any other cell information.\n    top_filtered_peaks.bed: Three-column list of peaks, which is a standard bed format file.\n                            It is same to the \"peaks.bed\" file in the CellRanger output of a 10X dataset.\n    filtered_reads.mtx: Fragment count matrix in mtx format, where a row is a peak and a column is a cell.\n                        It is same to the \"matrix.mtx\" file in the CellRanger output of a 10X dataset.\n                        The order of cells should be the same with \"filtered_cells.csv\".\n                        The order of peaks should be the same with \"top_filtered_peaks.bed.\n\n\n### 3. Functions of APEC (step by step)\n\n#### Users can directly run example projects and scripts in \"examples\" folder to generate figures listed in our APEC paper (https://www.biorxiv.org/content/10.1101/646331v4).\n\n#### 3.1 Clustering by APEC\n\nUse the following codes to cluster cells by APEC algorithm:\n\n    clustering.build_accesson('$project', ngroup=600)\n    clustering.cluster_byAccesson('$project', nc=0, norm='probability')\n    plot.plot_tsne('$project', rs=0)\n    plot.correlation('$project', cell_label='notes', clip=[0,1])\n\ninput parameters:\n\n    ngroup:   Number of accessons, default=600.\n    nc:       Number of cell clusters, set it to 0 if users want to predict it with APEC, default=0.\n    norm:     Normalization method, can be 'zscore', 'probability', or 'filter'; default='probability'.\n              If there are many noises in the fragment count matrix, please consider to set norm='filter'.\n    rs:             The random_seed parameter for tSNE, default=0.\n    cell_label:     Color labels for cells, can be 'notes' or 'cluster', default='notes'.\n                    If cell_label='cluster', it will use clustering result of clustering.cluster_byAccesson().\n    clip:           Range [min, max] for the correlation heatmap, default=[-1,1]\n\noutput files:\n\n    $project/matrix/Accesson_peaks.csv\n    $project/matrix/Accesson_reads.csv\n    $project/result/cluster_by_APEC.csv\n    $project/result/TSNE_by_APEC.csv\n    $project/figure/TSNE_by_APEC_with_notes_label.pdf\n    $project/figure/TSNE_by_APEC_with_cluster_label.pdf\n    $project/figure/cell_cell_correlation_by_APEC_with_notes_label.png\n\n<img src=\"images/TSNE_by_APEC_with_notes_label.jpg\" width=\"400\">\n\n_Figure A. TSNE_by_APEC_with_notes_label.pdf, where cells are labeled with cell types (the 'notes' column of filtered_cells.csv)_\n\n<img src=\"images/TSNE_by_APEC_with_cluster_label.jpg\" width=\"400\">\n\n_Figure B. TSNE_by_APEC_with_cluster_label.pdf, where cells are labeled with cell clusters (the 'cluster' column of cluster_by_APEC.csv)_\n\n#### 3.2 Clustering by chromVAR (optional, required for motif analysis)\n\nUse the following codes to cluster cells by chromVAR algorithm:\n\n    generate.motif_matrix('$project', genome_fa='$reference/hg19_chr.fa',\n                          background='$reference/tier1_markov1.norc.txt',\n                          meme='$reference/JASPAR2018_CORE_vertebrates_redundant_pfms_meme.txt',\n                          np=4)\n    clustering.cluster_byMotif('$project', np=4, nc=0, ns=50)\n\ninput parameters:\n\n    genome_fa:   Path to hg19_chr.fa or mm10_chr.fa in $reference folder.\n    background:  Path to tier1_markov1.norc.txt in $reference folder.\n    meme:        Path to JASPAR2018_CORE_vertebrates_redundant_pfms_meme.txt in $reference folder.\n    np:          Number of CPU cores used for parallel calculation, default=4.\n    nc:          Number of cell clusters, set it to 0 if users want to predict it using Louvain algorithm, default=0.\n    ns:          Number of permuted sampling, default=50.\n\noutput files:\n\n    $project/result/deviation_chromVAR.csv\n    $project/result/cluster_by_chromVAR.csv\n\n#### 3.3 Evaluate ARI, NMI and AMI for clustering result\n\nIf users have the real cell type in the 'notes' column of '$project/matrix/filtered_cells.csv', please use the following code to calculate ARI, NMI and AMI to estimate the accuracy of the clustering algorithm.\n\n    clustering.cluster_comparison('$project/matrix/filtered_cells.csv',\n                                  '$project/result/cluster_by_APEC.csv',\n                                  exclude='UNK')\n\nThe output ARI, NMI and AMI values will be printed on the screen directly. Please make sure that the column 'notes' of filtered_cells.csv denotes the cell type of each cell. For some datasets, such as the hematopoietic cells, the user should exclude all \"UNK\" cells (unknown type) before the calculation of ARI.\n\n#### 3.4 Generate pseudotime trajectory\n\nBy default, APEC adapts monocle to generate pseudotime trajectory from accesson matrix:\n\n    generate.monocle_trajectory('$project', npc=5)\n    plot.plot_trajectory('$project', cell_label='notes', angles=[30,30])\n\ninput parameters:\n\n    npc:            Number of principal components used to build trajectory, default=5.\n    cell_label:     Labels for cells, can be 'notes' or 'cluster', default='notes'.\n    angles:         Rotation angles for 3D trajectory, e.g. [100,20], default=[30,30].\n\noutput files:\n\n    $project/result/monocle_trajectory.csv\n    $project/result/monocle_reduced_dimension.csv\n    $project/figure/pseudotime_trajectory_with_notes_label.pdf\n\n<img src=\"images/pseudotime_trajectory_with_notes_label.jpg\" width=\"400\">\n\n_Figure C. pseudotime_trajectory_with_notes_label.pdf_\n\n#### 3.5 Generate gene expression\n\n    generate.gene_score('$project', genome_gtf='hg19_RefSeq_genes.gtf', distal=20000)\n\noutput file:\n\n    $project/matrix/genes_scored_by_TSS_peaks.csv\n    $project/peak/genes_TSS_peaks.csv\n\n#### 3.6 Generate differential feature for a cell cluster\n\nGet differential accessons:\n\n    generate.get_nearby_genes('$project')   # optional. Users should run step 3.5 before this.\n    generate.differential_feature('$project', feature='accesson', target='0', vs='all')\n\nGet differential motifs/genes:\n\n    generate.differential_feature('$project', feature='motif', target='0', vs='all')\n    generate.differential_feature('$project', feature='gene', target='0', vs='all')\n\ninput parameters:\n\n    feature:     Type of feature, can be 'accesson' or 'motif' or 'gene', default='accesson'.\n                 If feature='accesson', run step 3.1 first;\n                 if feature='motif', run step 3.2 first;\n                 if feature='gene', run step 3.5 first.\n    cell_label:  Cell Labels used for differential analysis, can be 'notes' or 'cluster', default='cluster'.\n    target:      The target cluster that users search for differential features, default='1'.\n                 If cell_label='cluster', target is one element in the 'cluster' column of cluster_by_APEC.csv file;\n                 if cell_label='notes', target is one element in the 'notes' column of filtered_cells.csv file.\n    vs:          Versus which clusters, can be '2,3,4' or 'all', default='all' (means all the rest clusters).\n    pvalue:      P-value for student-t test, default=0.01.\n    log2_fold:   Cutoff for log2(fold_change), default=1.\n\noutput file:\n\n    $project/result/differential_accesson_of_cluster_X_vs_XXX.csv\n    $project/result/differential_motif_of_cluster_X_vs_XXX.csv\n    $project/result/differential_gene_of_cluster_X_vs_XXX.csv\n\n#### 3.7 Plot motif/gene on tSNE/trajectory diagram\n\n    plot.plot_feature('$project', space='tsne', feature='gene', name='FOXO1')\n    plot.plot_feature('$project', space='trajectory', feature='motif', name='GATA1')\n\ninput parameters:\n\n    space:          In which space we draw the feature, can be 'tsne' or 'trajectory', default='tsne'.\n                    If space='tsne', run plot.plot_tsne() first;\n                    if space='trajectory', run step 3.4 first.\n    feature:        Type of the feature, can be 'accesson' or 'motif' or 'gene', default='accesson'.\n                    If feature='accesson', run step 3.1 first;\n                    if feature='motif', run step 3.2 first;\n                    if feature='gene', run step 3.5 first.\n    name:           Name of the feature.\n                    If feature='accesson', name=accesson number, i.e. '1';\n                    if feature='motif', name=motif symbol, i.e. 'GATA1';\n                    if feature='gene', name=gene symbol, i.e. 'CD36'.\n    clip:           Clip range for the input matrix, can be [min, max] or 'none', default='none'.\n    angles:         Rotation angles for 3D trajectory, e.g. [100,20], default=[30,30].\n\noutput files:\n\n    $project/figure/motif_XXX_on_trajectory_by_APEC.pdf\n    $project/figure/gene_XXX_on_tsne_by_APEC.pdf\n\n<img src=\"images/motif_GATA1_on_trajectory_by_APEC.jpg\" width=\"400\">\n\n_Figure D. motif_GATA1_on_trajectory_by_APEC.pdf_\n\n#### 3.8 Generate potential super enhancer\n\n    generate.super_enhancer('$project', super_range=1000000, p_cutoff=0.01)\n\ninput parameter:\n\n    super_range:    Genome range to search for super enhancer, default=1000000.\n    p_cutoff:       Cutoff of P-value, default=0.01.\n\noutput file:\n\n    $project/result/potential_super_enhancer.csv\n\n\n## Section Two. Get fragment count matrix from raw data\n### (This part is only available on GitHub:https://github.com/QuKunLab/APEC)\n\n### 1. Requirements and installation\n\nAll of the following software needs to be placed in the global environment of the Linux system to ensure that they can be called in any path/folder. Picard is also required, but we have placed it into $APEC/reference folder, and users don't need to install it. We recommend that users adopt the latest version of these software, except Meme (version 4.11.2).\n\n    Bowtie2: https://sourceforge.net/projects/bowtie-bio/files/bowtie2/2.2.9/\n    Samtools: https://github.com/samtools/samtools\n    Bedtools: http://bedtools.readthedocs.io/en/latest/content/installation.html\n    Macs2: https://github.com/taoliu/MACS.git\n    Meme 4.11.2: http://meme-suite.org/doc/download.html?man_type=web\n    pysam for python: set up by \"pip install pysam\"\n    Levenshtein for python: set up by \"pip install python-Levenshtein\"\n\n#### 1.2\tInstallation\n\nUsers can simply install this part by copying the **code_v1.2** folder and **reference** folder into a same path. Users **must** run ***APEC_prepare_steps.sh*** directly in code_v1.2/, since each program will invoke the reference files automatically. The **reference** folder is required, but we didn't upload reference files to GitHub since they are too big. Users can download all reference files from one of the following sites:\n\n-|website\n-|-\n1|http://galaxy.ustc.edu.cn:30803/APEC/reference/ <br> Due to server upgrades, this site will be temporarily unavailable from 2020-03-30 to 2020-04-01.\n2|https://apec.oss-us-east-1.aliyuncs.com/APEC/reference_full.zip.001 <br> https://apec.oss-us-east-1.aliyuncs.com/APEC/reference_full.zip.002 <br> https://apec.oss-us-east-1.aliyuncs.com/APEC/reference_full.zip.003\n\n The **reference** folder should contains the following files:\n\n    hg19_refseq_genes_TSS.txt, hg19_RefSeq_genes.gtf, hg19_blacklist.JDB.bed,\n    hg19_chr.fa, hg19_chr.fa.fai, hg19.chrom.sizes,\n    hg19.1.bt2, hg19.2.bt2, hg19.3.bt2, hg19.4.bt2, hg19.rev.1.bt2, hg19.rev.2.bt2,\n    mm10_refseq_genes_TSS.txt, mm10_RefSeq_genes.gtf, mm10_blacklist.BIN.bed,\n    mm10_chr.fa, mm10_chr.fa.fai, mm10.chrom.sizes,\n    mm10.1.bt2, mm10.2.bt2, mm10.3.bt2, mm10.4.bt2, mm10.rev.1.bt2, mm10.rev.2.bt2,\n    JASPAR2018_CORE_vertebrates_non-redundant_pfms_meme.txt, tier1_markov1.norc.txt, picard.jar\n\n### 2. Fragment count matrix\n\n#### 2.1\tArrangement of raw data\n\nThe **raw_data** folder should contain all raw sequencing fastq files into the. All these pair-end fastq files should be named as:\n\n    type1-001_1.fastq, type1-001_2.fastq, type1-002_1.fastq, type1-002_2.fastq, \u2026\u2026;\n    type2-001_1.fastq, type2-001_2.fastq, type2-002_1.fastq, type2-002_2.fastq, \u2026\u2026;\n    \u2026\u2026\n\nwhere \"\\_1\" and \"\\_2\" indicate forward and backward reads for pair-end sequencing. {type1, type2, ...} can be cell-types or batches of samples, such as {GM, K562, ...}, or {batch1, batch2, ...}, or any other words without underline \"\\_\" or dash \"-\".\nUsers need to build a **project** folder to store the result. The **work**, **matrix**, **peak** and **figure** folders will be automatically built by subsequent steps, and placed in **project** folder.\n\n#### 2.2\tEasy-run of matrix preparation\n\nUsers can use the script ***APEC_prepare_steps.sh*** to finish the process from raw data to fragment count matrix.  This script includes steps of \"trimming\", \"mapping\", \"peak calling\", \"aligning read counts matrix\", and \"quality contral\". Running this step on our example project (i.e. project01 with 672 cells) will take 10~20 hours on an 8-core 32 GB computer, since the sequence mapping step is the slowest step.\n\nExample:\n\n    bash APEC_prepare_steps.sh -r $raw_data -s $project -g hg19 -n 4 -l 3 -p 0.2 -f 2000\n\nInput parameters:\n\n    -r: The raw_data folder\n    -s: The project folder.\n    -g: \"hg19\" or \"mm10\".\n    -n: Number of CPU cores.\n    -l: Threshold for the \u2013log(Q-value) of peaks, used to filter peaks.\n    -p: Threshold of the percentage of fragments in peaks, used to filter cells.\n    -f: Threshold of the fragment number of each cell, used to filter cells.\n\nOutput files:\n\nThe script ***APEC_prepare_steps.sh*** will generate **work**, **peak**, **matrix**, and **figure** folders with many output files. Here, we only introduce files that are useful to users. For our example projects, all of these results can be reproduced on a general computer system.\n\n(1) In **work** folder:\n\nFor each cell, the mapping step can generate a subfolder (with cell name) in the **work** folder. There are several useful files in each subfolder:\n\n    cell_name.hist.pdf: A histogram of fragment length distribution of each cell.\n    cell_name.RefSeqTSS.pdf: Insert enrichment around TSS regions of each cell.\n\n(2) In **peak** folder:\n\n    mergeAll.hist.pdf: A histogram of fragment length distribution of all cells.\n    mergeAll.RefSeqTSS.pdf: Insert enrichment around TSS regions of all cells.\n    top_filtered_peaks.bed: Filtered top peaks, ranked by Q-value.\n\n(3) In **matrix** folder:\n\n    reads.csv: Fragment count matrix.\n    cell_info.merged.csv: Data quality report of each cell.\n    filtered_cells.csv: Filtered cells information in csv format.\n    filtered_reads.mtx: Filtered fragment count matrix in mtx format.\n\n(4) In **figure** folder:\n\n    cell_quality.pdf: A scatter plot of the fragment number and the percentage of fragments in peaks.\n\n### 3. Generate bigwig files for UCSC track\n\n    generate_UCSCtrack.py -s $project --cfile cluster.csv --gsize chrom.sizes\n\n    Options:\n      -s             The project folder.\n      --cfile        cluster.csv file, e.g. cluster_by_APEC.csv in\n                     $project/result/ folder\n      --gsize        chrom.size files, default=../reference/hg19.chrom.sizes\n\nThis script outputs bigwig files to $project/result/track/ folder.\n"
      },
      "source": "https://raw.githubusercontent.com/QuKunLab/APEC/master/README.md",
      "technique": "header_analysis"
    },
    {
      "confidence": 1,
      "result": {
        "original_header": "2.2    Easy-run of matrix preparation",
        "parent_header": [
          "User Guide for APEC (v1.2.2)",
          "Section Two. Get fragment count matrix from raw data",
          "2. Fragment count matrix"
        ],
        "type": "Text_excerpt",
        "value": "# User Guide for APEC (v1.2.2)\n\n(Accessibility Pattern based Epigenomic Clustering)\n\n<img src=\"images/workflow.jpg\" width=\"800\">\n\nAPEC can perform fine cell type clustering on single cell chromatin accessibility data from scATAC-seq, snATAC-seq, sciATAC-seq or any other relevant experiment. It can also be used to evaluate gene expression from relevant accesson, search for differential motifs/genes for each cell cluster, find super enhancers, and construct pseudo-time trajectory (by calling Monocle). **If users have already obtained the fragment-count-per-peak matrix from other mapping pipelines (such as CellRanger), please run APEC from [Section One \"Run APEC from fragment count matrix\"](#section-one-run-aepc-from-fragment-count-matrix). If users have only the raw fastq files, please jump to [Section Two \"Get fragment count matrix from raw data\"](#section-two-get-fragment-count-matrix-from-raw-data).**\n\n## Section One. Run AEPC from fragment count matrix\n\n### 1. Requirements and installation\n\n#### 1.1 Requirements\n\nAPEC requires Linux system (CentOS 7.3+ or Ubuntu 16.04+), as well as Python3 (3.6.8, not 3.7.x) and R (3.5.1+) environments. If users want to build pseudotime trajectory with APEC, please install Monocle (2.10.0, http://cole-trapnell-lab.github.io/monocle-release/docs/) in R (see [1.2 Install and import APEC](#12-install-and-import-apec)). Also, the following softwares are required for APEC if users want to run motif analysis (as chromVAR):\n\n    Bedtools: http://bedtools.readthedocs.io/en/latest/content/installation.html\n    Meme 4.11.2: http://meme-suite.org/doc/download.html?man_type=web (Meme 5.x.x is not compatible with APEC)\n\nThe files in **reference** folder are required for APEC. But we didn't upload reference files to GitHub since they are too big. Users can download all reference files from one of the following websites:\n\n-|website\n-|-\n1|http://galaxy.ustc.edu.cn:30803/APEC/reference/ <br> Due to server upgrades, this site will be temporarily unavailable from 2020-03-30 to 2020-04-01.\n2|https://apec.oss-us-east-1.aliyuncs.com/APEC/reference/reference.zip\n3|https://drive.google.com/drive/folders/1psK7za4KNJfqpigUaLMY3bWlqBHp1J5k?usp=sharing\n\nThe **reference** folder should contains the following files:\n\n    hg19_RefSeq_genes.gtf, hg19_chr.fa, hg19_chr.fa.fai,\n    mm10_RefSeq_genes.gtf, mm10_chr.fa, mm10_chr.fa.fai,\n    JASPAR2018_CORE_vertebrates_non-redundant_pfms_meme.txt, tier1_markov1.norc.txt\n\n#### 1.2 Install and import APEC\n\nUsers can install APEC by:\n\n    pip install APEC==1.2.2\n\nWe strongly recommend that users build a python 3.6.8 environment for APEC with **miniconda** or **anaconda**, since APEC is dependent on specific versions of python packages (see README.md in examples folder), and Monocle (2.10.0) can be installed in conda environment too. The commands to create a conda environment (named as apec_env) and install APEC and Monocle are:\n\n    conda create -n apec_env python=3.6.8\n    conda activate apec_env\n    pip install cmake==3.18.4\n    pip install APEC==1.2.2\n    conda install -n apec_env -c bioconda bioconductor-monocle=2.10.0\n\nIn Ipython, Jupyter-notebook or a python script, users can import packages of APEC by:\n\n    from APEC import clustering,plot,generate\n\nUsers can inquire the manual for each function of APEC by using \"help()\" in Ipython or Jupyter, for example:\n\n    help(clustering.cluster_byAccesson)\n\n### 2. Input data\n\nIf users have employed APEC to generate fragment count matrix from raw data (see [Section Two](#section-two-get-fragment-count-matrix-from-raw-data)), they can run AEPC clustering and subsequent analysis on the $project folder directly.\n\nIf using APEC for 10X scATAC-seq data, users can run the following script to prepare the project:\n\n    from APEC import convert\n    convert.convert_10X('$10X_data_folder/', '$project/')\n\nThe '$10X_data_folder' should contain 'barcodes.tsv', 'matrix.mtx' and 'peaks.bed' files, which are the results of Cellranger.\n\nIf using the matrix generated from other experiments, users need to prepare a project folder (termed '$project'), which contains **matrix** and **peak** folders. Please place \"filtered_cells.csv\" and \"filtered_reads.mtx\" in **matrix** folder, \"top_filtered_peaks.bed\" in **peak** folder. Here is the instruction for three input files:\n\n    filtered_cells.csv: Two-column (separated by tabs) list of cell information ('name' and 'notes'):\n                        The 'name' column stores cell names (or barcodes).\n                        The 'notes' column can be cell-type or any other cell information.\n    top_filtered_peaks.bed: Three-column list of peaks, which is a standard bed format file.\n                            It is same to the \"peaks.bed\" file in the CellRanger output of a 10X dataset.\n    filtered_reads.mtx: Fragment count matrix in mtx format, where a row is a peak and a column is a cell.\n                        It is same to the \"matrix.mtx\" file in the CellRanger output of a 10X dataset.\n                        The order of cells should be the same with \"filtered_cells.csv\".\n                        The order of peaks should be the same with \"top_filtered_peaks.bed.\n\n\n### 3. Functions of APEC (step by step)\n\n#### Users can directly run example projects and scripts in \"examples\" folder to generate figures listed in our APEC paper (https://www.biorxiv.org/content/10.1101/646331v4).\n\n#### 3.1 Clustering by APEC\n\nUse the following codes to cluster cells by APEC algorithm:\n\n    clustering.build_accesson('$project', ngroup=600)\n    clustering.cluster_byAccesson('$project', nc=0, norm='probability')\n    plot.plot_tsne('$project', rs=0)\n    plot.correlation('$project', cell_label='notes', clip=[0,1])\n\ninput parameters:\n\n    ngroup:   Number of accessons, default=600.\n    nc:       Number of cell clusters, set it to 0 if users want to predict it with APEC, default=0.\n    norm:     Normalization method, can be 'zscore', 'probability', or 'filter'; default='probability'.\n              If there are many noises in the fragment count matrix, please consider to set norm='filter'.\n    rs:             The random_seed parameter for tSNE, default=0.\n    cell_label:     Color labels for cells, can be 'notes' or 'cluster', default='notes'.\n                    If cell_label='cluster', it will use clustering result of clustering.cluster_byAccesson().\n    clip:           Range [min, max] for the correlation heatmap, default=[-1,1]\n\noutput files:\n\n    $project/matrix/Accesson_peaks.csv\n    $project/matrix/Accesson_reads.csv\n    $project/result/cluster_by_APEC.csv\n    $project/result/TSNE_by_APEC.csv\n    $project/figure/TSNE_by_APEC_with_notes_label.pdf\n    $project/figure/TSNE_by_APEC_with_cluster_label.pdf\n    $project/figure/cell_cell_correlation_by_APEC_with_notes_label.png\n\n<img src=\"images/TSNE_by_APEC_with_notes_label.jpg\" width=\"400\">\n\n_Figure A. TSNE_by_APEC_with_notes_label.pdf, where cells are labeled with cell types (the 'notes' column of filtered_cells.csv)_\n\n<img src=\"images/TSNE_by_APEC_with_cluster_label.jpg\" width=\"400\">\n\n_Figure B. TSNE_by_APEC_with_cluster_label.pdf, where cells are labeled with cell clusters (the 'cluster' column of cluster_by_APEC.csv)_\n\n#### 3.2 Clustering by chromVAR (optional, required for motif analysis)\n\nUse the following codes to cluster cells by chromVAR algorithm:\n\n    generate.motif_matrix('$project', genome_fa='$reference/hg19_chr.fa',\n                          background='$reference/tier1_markov1.norc.txt',\n                          meme='$reference/JASPAR2018_CORE_vertebrates_redundant_pfms_meme.txt',\n                          np=4)\n    clustering.cluster_byMotif('$project', np=4, nc=0, ns=50)\n\ninput parameters:\n\n    genome_fa:   Path to hg19_chr.fa or mm10_chr.fa in $reference folder.\n    background:  Path to tier1_markov1.norc.txt in $reference folder.\n    meme:        Path to JASPAR2018_CORE_vertebrates_redundant_pfms_meme.txt in $reference folder.\n    np:          Number of CPU cores used for parallel calculation, default=4.\n    nc:          Number of cell clusters, set it to 0 if users want to predict it using Louvain algorithm, default=0.\n    ns:          Number of permuted sampling, default=50.\n\noutput files:\n\n    $project/result/deviation_chromVAR.csv\n    $project/result/cluster_by_chromVAR.csv\n\n#### 3.3 Evaluate ARI, NMI and AMI for clustering result\n\nIf users have the real cell type in the 'notes' column of '$project/matrix/filtered_cells.csv', please use the following code to calculate ARI, NMI and AMI to estimate the accuracy of the clustering algorithm.\n\n    clustering.cluster_comparison('$project/matrix/filtered_cells.csv',\n                                  '$project/result/cluster_by_APEC.csv',\n                                  exclude='UNK')\n\nThe output ARI, NMI and AMI values will be printed on the screen directly. Please make sure that the column 'notes' of filtered_cells.csv denotes the cell type of each cell. For some datasets, such as the hematopoietic cells, the user should exclude all \"UNK\" cells (unknown type) before the calculation of ARI.\n\n#### 3.4 Generate pseudotime trajectory\n\nBy default, APEC adapts monocle to generate pseudotime trajectory from accesson matrix:\n\n    generate.monocle_trajectory('$project', npc=5)\n    plot.plot_trajectory('$project', cell_label='notes', angles=[30,30])\n\ninput parameters:\n\n    npc:            Number of principal components used to build trajectory, default=5.\n    cell_label:     Labels for cells, can be 'notes' or 'cluster', default='notes'.\n    angles:         Rotation angles for 3D trajectory, e.g. [100,20], default=[30,30].\n\noutput files:\n\n    $project/result/monocle_trajectory.csv\n    $project/result/monocle_reduced_dimension.csv\n    $project/figure/pseudotime_trajectory_with_notes_label.pdf\n\n<img src=\"images/pseudotime_trajectory_with_notes_label.jpg\" width=\"400\">\n\n_Figure C. pseudotime_trajectory_with_notes_label.pdf_\n\n#### 3.5 Generate gene expression\n\n    generate.gene_score('$project', genome_gtf='hg19_RefSeq_genes.gtf', distal=20000)\n\noutput file:\n\n    $project/matrix/genes_scored_by_TSS_peaks.csv\n    $project/peak/genes_TSS_peaks.csv\n\n#### 3.6 Generate differential feature for a cell cluster\n\nGet differential accessons:\n\n    generate.get_nearby_genes('$project')   # optional. Users should run step 3.5 before this.\n    generate.differential_feature('$project', feature='accesson', target='0', vs='all')\n\nGet differential motifs/genes:\n\n    generate.differential_feature('$project', feature='motif', target='0', vs='all')\n    generate.differential_feature('$project', feature='gene', target='0', vs='all')\n\ninput parameters:\n\n    feature:     Type of feature, can be 'accesson' or 'motif' or 'gene', default='accesson'.\n                 If feature='accesson', run step 3.1 first;\n                 if feature='motif', run step 3.2 first;\n                 if feature='gene', run step 3.5 first.\n    cell_label:  Cell Labels used for differential analysis, can be 'notes' or 'cluster', default='cluster'.\n    target:      The target cluster that users search for differential features, default='1'.\n                 If cell_label='cluster', target is one element in the 'cluster' column of cluster_by_APEC.csv file;\n                 if cell_label='notes', target is one element in the 'notes' column of filtered_cells.csv file.\n    vs:          Versus which clusters, can be '2,3,4' or 'all', default='all' (means all the rest clusters).\n    pvalue:      P-value for student-t test, default=0.01.\n    log2_fold:   Cutoff for log2(fold_change), default=1.\n\noutput file:\n\n    $project/result/differential_accesson_of_cluster_X_vs_XXX.csv\n    $project/result/differential_motif_of_cluster_X_vs_XXX.csv\n    $project/result/differential_gene_of_cluster_X_vs_XXX.csv\n\n#### 3.7 Plot motif/gene on tSNE/trajectory diagram\n\n    plot.plot_feature('$project', space='tsne', feature='gene', name='FOXO1')\n    plot.plot_feature('$project', space='trajectory', feature='motif', name='GATA1')\n\ninput parameters:\n\n    space:          In which space we draw the feature, can be 'tsne' or 'trajectory', default='tsne'.\n                    If space='tsne', run plot.plot_tsne() first;\n                    if space='trajectory', run step 3.4 first.\n    feature:        Type of the feature, can be 'accesson' or 'motif' or 'gene', default='accesson'.\n                    If feature='accesson', run step 3.1 first;\n                    if feature='motif', run step 3.2 first;\n                    if feature='gene', run step 3.5 first.\n    name:           Name of the feature.\n                    If feature='accesson', name=accesson number, i.e. '1';\n                    if feature='motif', name=motif symbol, i.e. 'GATA1';\n                    if feature='gene', name=gene symbol, i.e. 'CD36'.\n    clip:           Clip range for the input matrix, can be [min, max] or 'none', default='none'.\n    angles:         Rotation angles for 3D trajectory, e.g. [100,20], default=[30,30].\n\noutput files:\n\n    $project/figure/motif_XXX_on_trajectory_by_APEC.pdf\n    $project/figure/gene_XXX_on_tsne_by_APEC.pdf\n\n<img src=\"images/motif_GATA1_on_trajectory_by_APEC.jpg\" width=\"400\">\n\n_Figure D. motif_GATA1_on_trajectory_by_APEC.pdf_\n\n#### 3.8 Generate potential super enhancer\n\n    generate.super_enhancer('$project', super_range=1000000, p_cutoff=0.01)\n\ninput parameter:\n\n    super_range:    Genome range to search for super enhancer, default=1000000.\n    p_cutoff:       Cutoff of P-value, default=0.01.\n\noutput file:\n\n    $project/result/potential_super_enhancer.csv\n\n\n## Section Two. Get fragment count matrix from raw data\n### (This part is only available on GitHub:https://github.com/QuKunLab/APEC)\n\n### 1. Requirements and installation\n\nAll of the following software needs to be placed in the global environment of the Linux system to ensure that they can be called in any path/folder. Picard is also required, but we have placed it into $APEC/reference folder, and users don't need to install it. We recommend that users adopt the latest version of these software, except Meme (version 4.11.2).\n\n    Bowtie2: https://sourceforge.net/projects/bowtie-bio/files/bowtie2/2.2.9/\n    Samtools: https://github.com/samtools/samtools\n    Bedtools: http://bedtools.readthedocs.io/en/latest/content/installation.html\n    Macs2: https://github.com/taoliu/MACS.git\n    Meme 4.11.2: http://meme-suite.org/doc/download.html?man_type=web\n    pysam for python: set up by \"pip install pysam\"\n    Levenshtein for python: set up by \"pip install python-Levenshtein\"\n\n#### 1.2\tInstallation\n\nUsers can simply install this part by copying the **code_v1.2** folder and **reference** folder into a same path. Users **must** run ***APEC_prepare_steps.sh*** directly in code_v1.2/, since each program will invoke the reference files automatically. The **reference** folder is required, but we didn't upload reference files to GitHub since they are too big. Users can download all reference files from one of the following sites:\n\n-|website\n-|-\n1|http://galaxy.ustc.edu.cn:30803/APEC/reference/ <br> Due to server upgrades, this site will be temporarily unavailable from 2020-03-30 to 2020-04-01.\n2|https://apec.oss-us-east-1.aliyuncs.com/APEC/reference_full.zip.001 <br> https://apec.oss-us-east-1.aliyuncs.com/APEC/reference_full.zip.002 <br> https://apec.oss-us-east-1.aliyuncs.com/APEC/reference_full.zip.003\n\n The **reference** folder should contains the following files:\n\n    hg19_refseq_genes_TSS.txt, hg19_RefSeq_genes.gtf, hg19_blacklist.JDB.bed,\n    hg19_chr.fa, hg19_chr.fa.fai, hg19.chrom.sizes,\n    hg19.1.bt2, hg19.2.bt2, hg19.3.bt2, hg19.4.bt2, hg19.rev.1.bt2, hg19.rev.2.bt2,\n    mm10_refseq_genes_TSS.txt, mm10_RefSeq_genes.gtf, mm10_blacklist.BIN.bed,\n    mm10_chr.fa, mm10_chr.fa.fai, mm10.chrom.sizes,\n    mm10.1.bt2, mm10.2.bt2, mm10.3.bt2, mm10.4.bt2, mm10.rev.1.bt2, mm10.rev.2.bt2,\n    JASPAR2018_CORE_vertebrates_non-redundant_pfms_meme.txt, tier1_markov1.norc.txt, picard.jar\n\n### 2. Fragment count matrix\n\n#### 2.1\tArrangement of raw data\n\nThe **raw_data** folder should contain all raw sequencing fastq files into the. All these pair-end fastq files should be named as:\n\n    type1-001_1.fastq, type1-001_2.fastq, type1-002_1.fastq, type1-002_2.fastq, \u2026\u2026;\n    type2-001_1.fastq, type2-001_2.fastq, type2-002_1.fastq, type2-002_2.fastq, \u2026\u2026;\n    \u2026\u2026\n\nwhere \"\\_1\" and \"\\_2\" indicate forward and backward reads for pair-end sequencing. {type1, type2, ...} can be cell-types or batches of samples, such as {GM, K562, ...}, or {batch1, batch2, ...}, or any other words without underline \"\\_\" or dash \"-\".\nUsers need to build a **project** folder to store the result. The **work**, **matrix**, **peak** and **figure** folders will be automatically built by subsequent steps, and placed in **project** folder.\n\n#### 2.2\tEasy-run of matrix preparation\n\nUsers can use the script ***APEC_prepare_steps.sh*** to finish the process from raw data to fragment count matrix.  This script includes steps of \"trimming\", \"mapping\", \"peak calling\", \"aligning read counts matrix\", and \"quality contral\". Running this step on our example project (i.e. project01 with 672 cells) will take 10~20 hours on an 8-core 32 GB computer, since the sequence mapping step is the slowest step.\n\nExample:\n\n    bash APEC_prepare_steps.sh -r $raw_data -s $project -g hg19 -n 4 -l 3 -p 0.2 -f 2000\n\nInput parameters:\n\n    -r: The raw_data folder\n    -s: The project folder.\n    -g: \"hg19\" or \"mm10\".\n    -n: Number of CPU cores.\n    -l: Threshold for the \u2013log(Q-value) of peaks, used to filter peaks.\n    -p: Threshold of the percentage of fragments in peaks, used to filter cells.\n    -f: Threshold of the fragment number of each cell, used to filter cells.\n\nOutput files:\n\nThe script ***APEC_prepare_steps.sh*** will generate **work**, **peak**, **matrix**, and **figure** folders with many output files. Here, we only introduce files that are useful to users. For our example projects, all of these results can be reproduced on a general computer system.\n\n(1) In **work** folder:\n\nFor each cell, the mapping step can generate a subfolder (with cell name) in the **work** folder. There are several useful files in each subfolder:\n\n    cell_name.hist.pdf: A histogram of fragment length distribution of each cell.\n    cell_name.RefSeqTSS.pdf: Insert enrichment around TSS regions of each cell.\n\n(2) In **peak** folder:\n\n    mergeAll.hist.pdf: A histogram of fragment length distribution of all cells.\n    mergeAll.RefSeqTSS.pdf: Insert enrichment around TSS regions of all cells.\n    top_filtered_peaks.bed: Filtered top peaks, ranked by Q-value.\n\n(3) In **matrix** folder:\n\n    reads.csv: Fragment count matrix.\n    cell_info.merged.csv: Data quality report of each cell.\n    filtered_cells.csv: Filtered cells information in csv format.\n    filtered_reads.mtx: Filtered fragment count matrix in mtx format.\n\n(4) In **figure** folder:\n\n    cell_quality.pdf: A scatter plot of the fragment number and the percentage of fragments in peaks.\n"
      },
      "source": "https://raw.githubusercontent.com/QuKunLab/APEC/master/README.md",
      "technique": "header_analysis"
    },
    {
      "confidence": 1,
      "result": {
        "original_header": "3. Generate bigwig files for UCSC track",
        "parent_header": [
          "User Guide for APEC (v1.2.2)",
          "Section Two. Get fragment count matrix from raw data"
        ],
        "type": "Text_excerpt",
        "value": "    generate_UCSCtrack.py -s $project --cfile cluster.csv --gsize chrom.sizes\n\n    Options:\n      -s             The project folder.\n      --cfile        cluster.csv file, e.g. cluster_by_APEC.csv in\n                     $project/result/ folder\n      --gsize        chrom.size files, default=../reference/hg19.chrom.sizes\n\nThis script outputs bigwig files to $project/result/track/ folder.\n"
      },
      "source": "https://raw.githubusercontent.com/QuKunLab/APEC/master/README.md",
      "technique": "header_analysis"
    }
  ],
  "issue_tracker": [
    {
      "confidence": 1,
      "result": {
        "type": "Url",
        "value": "https://api.github.com/repos/QuKunLab/APEC/issues"
      },
      "technique": "GitHub_API"
    }
  ],
  "keywords": [
    {
      "confidence": 1,
      "result": {
        "type": "String",
        "value": ""
      },
      "technique": "GitHub_API"
    }
  ],
  "license": [
    {
      "confidence": 1,
      "result": {
        "name": "BSD 2-Clause \"Simplified\" License",
        "spdx_id": "BSD-2-Clause",
        "type": "License",
        "url": "https://api.github.com/licenses/bsd-2-clause",
        "value": "https://api.github.com/licenses/bsd-2-clause"
      },
      "technique": "GitHub_API"
    }
  ],
  "logo": [
    {
      "confidence": 1,
      "result": {
        "type": "Url",
        "value": "https://raw.githubusercontent.com/QuKunLab/APEC/master/images/TSNE_by_APEC_with_notes_label.jpg"
      },
      "source": "https://raw.githubusercontent.com/QuKunLab/APEC/master/README.md",
      "technique": "regular_expression"
    }
  ],
  "name": [
    {
      "confidence": 1,
      "result": {
        "type": "String",
        "value": "APEC"
      },
      "technique": "GitHub_API"
    }
  ],
  "owner": [
    {
      "confidence": 1,
      "result": {
        "type": "User",
        "value": "QuKunLab"
      },
      "technique": "GitHub_API"
    }
  ],
  "programming_languages": [
    {
      "confidence": 1,
      "result": {
        "name": "Python",
        "size": 280879,
        "type": "Programming_language",
        "value": "Python"
      },
      "technique": "GitHub_API"
    },
    {
      "confidence": 1,
      "result": {
        "name": "Shell",
        "size": 8595,
        "type": "Programming_language",
        "value": "Shell"
      },
      "technique": "GitHub_API"
    },
    {
      "confidence": 1,
      "result": {
        "name": "R",
        "size": 926,
        "type": "Programming_language",
        "value": "R"
      },
      "technique": "GitHub_API"
    }
  ],
  "readme_url": [
    {
      "confidence": 1,
      "result": {
        "type": "Url",
        "value": "https://raw.githubusercontent.com/QuKunLab/APEC/master/README.md"
      },
      "technique": "file_exploration"
    }
  ],
  "requirements": [
    {
      "confidence": 1,
      "result": {
        "original_header": "1.1 Requirements",
        "parent_header": [
          "User Guide for APEC (v1.2.2)",
          "Section One. Run AEPC from fragment count matrix",
          "1. Requirements and installation"
        ],
        "type": "Text_excerpt",
        "value": "APEC requires Linux system (CentOS 7.3+ or Ubuntu 16.04+), as well as Python3 (3.6.8, not 3.7.x) and R (3.5.1+) environments. If users want to build pseudotime trajectory with APEC, please install Monocle (2.10.0, http://cole-trapnell-lab.github.io/monocle-release/docs/) in R (see [1.2 Install and import APEC](#12-install-and-import-apec)). Also, the following softwares are required for APEC if users want to run motif analysis (as chromVAR):\n\n    Bedtools: http://bedtools.readthedocs.io/en/latest/content/installation.html\n    Meme 4.11.2: http://meme-suite.org/doc/download.html?man_type=web (Meme 5.x.x is not compatible with APEC)\n\nThe files in **reference** folder are required for APEC. But we didn't upload reference files to GitHub since they are too big. Users can download all reference files from one of the following websites:\n\n-|website\n-|-\n1|http://galaxy.ustc.edu.cn:30803/APEC/reference/ <br> Due to server upgrades, this site will be temporarily unavailable from 2020-03-30 to 2020-04-01.\n2|https://apec.oss-us-east-1.aliyuncs.com/APEC/reference/reference.zip\n3|https://drive.google.com/drive/folders/1psK7za4KNJfqpigUaLMY3bWlqBHp1J5k?usp=sharing\n\nThe **reference** folder should contains the following files:\n\n    hg19_RefSeq_genes.gtf, hg19_chr.fa, hg19_chr.fa.fai,\n    mm10_RefSeq_genes.gtf, mm10_chr.fa, mm10_chr.fa.fai,\n    JASPAR2018_CORE_vertebrates_non-redundant_pfms_meme.txt, tier1_markov1.norc.txt\n"
      },
      "source": "https://raw.githubusercontent.com/QuKunLab/APEC/master/README.md",
      "technique": "header_analysis"
    }
  ],
  "run": [
    {
      "confidence": 1,
      "result": {
        "original_header": "2. Input data",
        "parent_header": [
          "User Guide for APEC (v1.2.2)",
          "Section One. Run AEPC from fragment count matrix"
        ],
        "type": "Text_excerpt",
        "value": "If users have employed APEC to generate fragment count matrix from raw data (see [Section Two](#section-two-get-fragment-count-matrix-from-raw-data)), they can run AEPC clustering and subsequent analysis on the $project folder directly.\n\nIf using APEC for 10X scATAC-seq data, users can run the following script to prepare the project:\n\n    from APEC import convert\n    convert.convert_10X('$10X_data_folder/', '$project/')\n\nThe '$10X_data_folder' should contain 'barcodes.tsv', 'matrix.mtx' and 'peaks.bed' files, which are the results of Cellranger.\n\nIf using the matrix generated from other experiments, users need to prepare a project folder (termed '$project'), which contains **matrix** and **peak** folders. Please place \"filtered_cells.csv\" and \"filtered_reads.mtx\" in **matrix** folder, \"top_filtered_peaks.bed\" in **peak** folder. Here is the instruction for three input files:\n\n    filtered_cells.csv: Two-column (separated by tabs) list of cell information ('name' and 'notes'):\n                        The 'name' column stores cell names (or barcodes).\n                        The 'notes' column can be cell-type or any other cell information.\n    top_filtered_peaks.bed: Three-column list of peaks, which is a standard bed format file.\n                            It is same to the \"peaks.bed\" file in the CellRanger output of a 10X dataset.\n    filtered_reads.mtx: Fragment count matrix in mtx format, where a row is a peak and a column is a cell.\n                        It is same to the \"matrix.mtx\" file in the CellRanger output of a 10X dataset.\n                        The order of cells should be the same with \"filtered_cells.csv\".\n                        The order of peaks should be the same with \"top_filtered_peaks.bed.\n\n"
      },
      "source": "https://raw.githubusercontent.com/QuKunLab/APEC/master/README.md",
      "technique": "header_analysis"
    },
    {
      "confidence": 1,
      "result": {
        "original_header": "3.1 Clustering by APEC",
        "parent_header": [
          "User Guide for APEC (v1.2.2)",
          "Section One. Run AEPC from fragment count matrix",
          "3. Functions of APEC (step by step)"
        ],
        "type": "Text_excerpt",
        "value": "Use the following codes to cluster cells by APEC algorithm:\n\n    clustering.build_accesson('$project', ngroup=600)\n    clustering.cluster_byAccesson('$project', nc=0, norm='probability')\n    plot.plot_tsne('$project', rs=0)\n    plot.correlation('$project', cell_label='notes', clip=[0,1])\n\ninput parameters:\n\n    ngroup:   Number of accessons, default=600.\n    nc:       Number of cell clusters, set it to 0 if users want to predict it with APEC, default=0.\n    norm:     Normalization method, can be 'zscore', 'probability', or 'filter'; default='probability'.\n              If there are many noises in the fragment count matrix, please consider to set norm='filter'.\n    rs:             The random_seed parameter for tSNE, default=0.\n    cell_label:     Color labels for cells, can be 'notes' or 'cluster', default='notes'.\n                    If cell_label='cluster', it will use clustering result of clustering.cluster_byAccesson().\n    clip:           Range [min, max] for the correlation heatmap, default=[-1,1]\n\noutput files:\n\n    $project/matrix/Accesson_peaks.csv\n    $project/matrix/Accesson_reads.csv\n    $project/result/cluster_by_APEC.csv\n    $project/result/TSNE_by_APEC.csv\n    $project/figure/TSNE_by_APEC_with_notes_label.pdf\n    $project/figure/TSNE_by_APEC_with_cluster_label.pdf\n    $project/figure/cell_cell_correlation_by_APEC_with_notes_label.png\n\n<img src=\"images/TSNE_by_APEC_with_notes_label.jpg\" width=\"400\">\n\n_Figure A. TSNE_by_APEC_with_notes_label.pdf, where cells are labeled with cell types (the 'notes' column of filtered_cells.csv)_\n\n<img src=\"images/TSNE_by_APEC_with_cluster_label.jpg\" width=\"400\">\n\n_Figure B. TSNE_by_APEC_with_cluster_label.pdf, where cells are labeled with cell clusters (the 'cluster' column of cluster_by_APEC.csv)_\n"
      },
      "source": "https://raw.githubusercontent.com/QuKunLab/APEC/master/README.md",
      "technique": "header_analysis"
    },
    {
      "confidence": 1,
      "result": {
        "original_header": "3.2 Clustering by chromVAR (optional, required for motif analysis)",
        "parent_header": [
          "User Guide for APEC (v1.2.2)",
          "Section One. Run AEPC from fragment count matrix",
          "3. Functions of APEC (step by step)"
        ],
        "type": "Text_excerpt",
        "value": "Use the following codes to cluster cells by chromVAR algorithm:\n\n    generate.motif_matrix('$project', genome_fa='$reference/hg19_chr.fa',\n                          background='$reference/tier1_markov1.norc.txt',\n                          meme='$reference/JASPAR2018_CORE_vertebrates_redundant_pfms_meme.txt',\n                          np=4)\n    clustering.cluster_byMotif('$project', np=4, nc=0, ns=50)\n\ninput parameters:\n\n    genome_fa:   Path to hg19_chr.fa or mm10_chr.fa in $reference folder.\n    background:  Path to tier1_markov1.norc.txt in $reference folder.\n    meme:        Path to JASPAR2018_CORE_vertebrates_redundant_pfms_meme.txt in $reference folder.\n    np:          Number of CPU cores used for parallel calculation, default=4.\n    nc:          Number of cell clusters, set it to 0 if users want to predict it using Louvain algorithm, default=0.\n    ns:          Number of permuted sampling, default=50.\n\noutput files:\n\n    $project/result/deviation_chromVAR.csv\n    $project/result/cluster_by_chromVAR.csv\n"
      },
      "source": "https://raw.githubusercontent.com/QuKunLab/APEC/master/README.md",
      "technique": "header_analysis"
    },
    {
      "confidence": 1,
      "result": {
        "original_header": "3.3 Evaluate ARI, NMI and AMI for clustering result",
        "parent_header": [
          "User Guide for APEC (v1.2.2)",
          "Section One. Run AEPC from fragment count matrix",
          "3. Functions of APEC (step by step)"
        ],
        "type": "Text_excerpt",
        "value": "If users have the real cell type in the 'notes' column of '$project/matrix/filtered_cells.csv', please use the following code to calculate ARI, NMI and AMI to estimate the accuracy of the clustering algorithm.\n\n    clustering.cluster_comparison('$project/matrix/filtered_cells.csv',\n                                  '$project/result/cluster_by_APEC.csv',\n                                  exclude='UNK')\n\nThe output ARI, NMI and AMI values will be printed on the screen directly. Please make sure that the column 'notes' of filtered_cells.csv denotes the cell type of each cell. For some datasets, such as the hematopoietic cells, the user should exclude all \"UNK\" cells (unknown type) before the calculation of ARI.\n"
      },
      "source": "https://raw.githubusercontent.com/QuKunLab/APEC/master/README.md",
      "technique": "header_analysis"
    },
    {
      "confidence": 1,
      "result": {
        "original_header": "3.4 Generate pseudotime trajectory",
        "parent_header": [
          "User Guide for APEC (v1.2.2)",
          "Section One. Run AEPC from fragment count matrix",
          "3. Functions of APEC (step by step)"
        ],
        "type": "Text_excerpt",
        "value": "By default, APEC adapts monocle to generate pseudotime trajectory from accesson matrix:\n\n    generate.monocle_trajectory('$project', npc=5)\n    plot.plot_trajectory('$project', cell_label='notes', angles=[30,30])\n\ninput parameters:\n\n    npc:            Number of principal components used to build trajectory, default=5.\n    cell_label:     Labels for cells, can be 'notes' or 'cluster', default='notes'.\n    angles:         Rotation angles for 3D trajectory, e.g. [100,20], default=[30,30].\n\noutput files:\n\n    $project/result/monocle_trajectory.csv\n    $project/result/monocle_reduced_dimension.csv\n    $project/figure/pseudotime_trajectory_with_notes_label.pdf\n\n<img src=\"images/pseudotime_trajectory_with_notes_label.jpg\" width=\"400\">\n\n_Figure C. pseudotime_trajectory_with_notes_label.pdf_\n"
      },
      "source": "https://raw.githubusercontent.com/QuKunLab/APEC/master/README.md",
      "technique": "header_analysis"
    },
    {
      "confidence": 1,
      "result": {
        "original_header": "3.5 Generate gene expression",
        "parent_header": [
          "User Guide for APEC (v1.2.2)",
          "Section One. Run AEPC from fragment count matrix",
          "3. Functions of APEC (step by step)"
        ],
        "type": "Text_excerpt",
        "value": "    generate.gene_score('$project', genome_gtf='hg19_RefSeq_genes.gtf', distal=20000)\n\noutput file:\n\n    $project/matrix/genes_scored_by_TSS_peaks.csv\n    $project/peak/genes_TSS_peaks.csv\n"
      },
      "source": "https://raw.githubusercontent.com/QuKunLab/APEC/master/README.md",
      "technique": "header_analysis"
    },
    {
      "confidence": 1,
      "result": {
        "original_header": "3.6 Generate differential feature for a cell cluster",
        "parent_header": [
          "User Guide for APEC (v1.2.2)",
          "Section One. Run AEPC from fragment count matrix",
          "3. Functions of APEC (step by step)"
        ],
        "type": "Text_excerpt",
        "value": "Get differential accessons:\n\n    generate.get_nearby_genes('$project')   # optional. Users should run step 3.5 before this.\n    generate.differential_feature('$project', feature='accesson', target='0', vs='all')\n\nGet differential motifs/genes:\n\n    generate.differential_feature('$project', feature='motif', target='0', vs='all')\n    generate.differential_feature('$project', feature='gene', target='0', vs='all')\n\ninput parameters:\n\n    feature:     Type of feature, can be 'accesson' or 'motif' or 'gene', default='accesson'.\n                 If feature='accesson', run step 3.1 first;\n                 if feature='motif', run step 3.2 first;\n                 if feature='gene', run step 3.5 first.\n    cell_label:  Cell Labels used for differential analysis, can be 'notes' or 'cluster', default='cluster'.\n    target:      The target cluster that users search for differential features, default='1'.\n                 If cell_label='cluster', target is one element in the 'cluster' column of cluster_by_APEC.csv file;\n                 if cell_label='notes', target is one element in the 'notes' column of filtered_cells.csv file.\n    vs:          Versus which clusters, can be '2,3,4' or 'all', default='all' (means all the rest clusters).\n    pvalue:      P-value for student-t test, default=0.01.\n    log2_fold:   Cutoff for log2(fold_change), default=1.\n\noutput file:\n\n    $project/result/differential_accesson_of_cluster_X_vs_XXX.csv\n    $project/result/differential_motif_of_cluster_X_vs_XXX.csv\n    $project/result/differential_gene_of_cluster_X_vs_XXX.csv\n"
      },
      "source": "https://raw.githubusercontent.com/QuKunLab/APEC/master/README.md",
      "technique": "header_analysis"
    },
    {
      "confidence": 1,
      "result": {
        "original_header": "3.7 Plot motif/gene on tSNE/trajectory diagram",
        "parent_header": [
          "User Guide for APEC (v1.2.2)",
          "Section One. Run AEPC from fragment count matrix",
          "3. Functions of APEC (step by step)"
        ],
        "type": "Text_excerpt",
        "value": "    plot.plot_feature('$project', space='tsne', feature='gene', name='FOXO1')\n    plot.plot_feature('$project', space='trajectory', feature='motif', name='GATA1')\n\ninput parameters:\n\n    space:          In which space we draw the feature, can be 'tsne' or 'trajectory', default='tsne'.\n                    If space='tsne', run plot.plot_tsne() first;\n                    if space='trajectory', run step 3.4 first.\n    feature:        Type of the feature, can be 'accesson' or 'motif' or 'gene', default='accesson'.\n                    If feature='accesson', run step 3.1 first;\n                    if feature='motif', run step 3.2 first;\n                    if feature='gene', run step 3.5 first.\n    name:           Name of the feature.\n                    If feature='accesson', name=accesson number, i.e. '1';\n                    if feature='motif', name=motif symbol, i.e. 'GATA1';\n                    if feature='gene', name=gene symbol, i.e. 'CD36'.\n    clip:           Clip range for the input matrix, can be [min, max] or 'none', default='none'.\n    angles:         Rotation angles for 3D trajectory, e.g. [100,20], default=[30,30].\n\noutput files:\n\n    $project/figure/motif_XXX_on_trajectory_by_APEC.pdf\n    $project/figure/gene_XXX_on_tsne_by_APEC.pdf\n\n<img src=\"images/motif_GATA1_on_trajectory_by_APEC.jpg\" width=\"400\">\n\n_Figure D. motif_GATA1_on_trajectory_by_APEC.pdf_\n"
      },
      "source": "https://raw.githubusercontent.com/QuKunLab/APEC/master/README.md",
      "technique": "header_analysis"
    },
    {
      "confidence": 1,
      "result": {
        "original_header": "3.8 Generate potential super enhancer",
        "parent_header": [
          "User Guide for APEC (v1.2.2)",
          "Section One. Run AEPC from fragment count matrix",
          "3. Functions of APEC (step by step)"
        ],
        "type": "Text_excerpt",
        "value": "    generate.super_enhancer('$project', super_range=1000000, p_cutoff=0.01)\n\ninput parameter:\n\n    super_range:    Genome range to search for super enhancer, default=1000000.\n    p_cutoff:       Cutoff of P-value, default=0.01.\n\noutput file:\n\n    $project/result/potential_super_enhancer.csv\n\n"
      },
      "source": "https://raw.githubusercontent.com/QuKunLab/APEC/master/README.md",
      "technique": "header_analysis"
    }
  ],
  "somef_missing_categories": [
    "citation",
    "acknowledgement",
    "download",
    "contact",
    "contributors",
    "faq",
    "support",
    "identifier",
    "has_build_file",
    "executable_example"
  ],
  "somef_provenance": {
    "date": "2024-11-04 04:59:32",
    "somef_schema_version": "1.0.0",
    "somef_version": "0.9.5"
  },
  "stargazers_count": [
    {
      "confidence": 1,
      "result": {
        "type": "Number",
        "value": 23
      },
      "technique": "GitHub_API"
    }
  ],
  "usage": [
    {
      "confidence": 1,
      "result": {
        "original_header": "2.1    Arrangement of raw data",
        "parent_header": [
          "User Guide for APEC (v1.2.2)",
          "Section Two. Get fragment count matrix from raw data",
          "2. Fragment count matrix"
        ],
        "type": "Text_excerpt",
        "value": "# User Guide for APEC (v1.2.2)\n\n(Accessibility Pattern based Epigenomic Clustering)\n\n<img src=\"images/workflow.jpg\" width=\"800\">\n\nAPEC can perform fine cell type clustering on single cell chromatin accessibility data from scATAC-seq, snATAC-seq, sciATAC-seq or any other relevant experiment. It can also be used to evaluate gene expression from relevant accesson, search for differential motifs/genes for each cell cluster, find super enhancers, and construct pseudo-time trajectory (by calling Monocle). **If users have already obtained the fragment-count-per-peak matrix from other mapping pipelines (such as CellRanger), please run APEC from [Section One \"Run APEC from fragment count matrix\"](#section-one-run-aepc-from-fragment-count-matrix). If users have only the raw fastq files, please jump to [Section Two \"Get fragment count matrix from raw data\"](#section-two-get-fragment-count-matrix-from-raw-data).**\n\n## Section One. Run AEPC from fragment count matrix\n\n### 1. Requirements and installation\n\n#### 1.1 Requirements\n\nAPEC requires Linux system (CentOS 7.3+ or Ubuntu 16.04+), as well as Python3 (3.6.8, not 3.7.x) and R (3.5.1+) environments. If users want to build pseudotime trajectory with APEC, please install Monocle (2.10.0, http://cole-trapnell-lab.github.io/monocle-release/docs/) in R (see [1.2 Install and import APEC](#12-install-and-import-apec)). Also, the following softwares are required for APEC if users want to run motif analysis (as chromVAR):\n\n    Bedtools: http://bedtools.readthedocs.io/en/latest/content/installation.html\n    Meme 4.11.2: http://meme-suite.org/doc/download.html?man_type=web (Meme 5.x.x is not compatible with APEC)\n\nThe files in **reference** folder are required for APEC. But we didn't upload reference files to GitHub since they are too big. Users can download all reference files from one of the following websites:\n\n-|website\n-|-\n1|http://galaxy.ustc.edu.cn:30803/APEC/reference/ <br> Due to server upgrades, this site will be temporarily unavailable from 2020-03-30 to 2020-04-01.\n2|https://apec.oss-us-east-1.aliyuncs.com/APEC/reference/reference.zip\n3|https://drive.google.com/drive/folders/1psK7za4KNJfqpigUaLMY3bWlqBHp1J5k?usp=sharing\n\nThe **reference** folder should contains the following files:\n\n    hg19_RefSeq_genes.gtf, hg19_chr.fa, hg19_chr.fa.fai,\n    mm10_RefSeq_genes.gtf, mm10_chr.fa, mm10_chr.fa.fai,\n    JASPAR2018_CORE_vertebrates_non-redundant_pfms_meme.txt, tier1_markov1.norc.txt\n\n#### 1.2 Install and import APEC\n\nUsers can install APEC by:\n\n    pip install APEC==1.2.2\n\nWe strongly recommend that users build a python 3.6.8 environment for APEC with **miniconda** or **anaconda**, since APEC is dependent on specific versions of python packages (see README.md in examples folder), and Monocle (2.10.0) can be installed in conda environment too. The commands to create a conda environment (named as apec_env) and install APEC and Monocle are:\n\n    conda create -n apec_env python=3.6.8\n    conda activate apec_env\n    pip install cmake==3.18.4\n    pip install APEC==1.2.2\n    conda install -n apec_env -c bioconda bioconductor-monocle=2.10.0\n\nIn Ipython, Jupyter-notebook or a python script, users can import packages of APEC by:\n\n    from APEC import clustering,plot,generate\n\nUsers can inquire the manual for each function of APEC by using \"help()\" in Ipython or Jupyter, for example:\n\n    help(clustering.cluster_byAccesson)\n\n### 2. Input data\n\nIf users have employed APEC to generate fragment count matrix from raw data (see [Section Two](#section-two-get-fragment-count-matrix-from-raw-data)), they can run AEPC clustering and subsequent analysis on the $project folder directly.\n\nIf using APEC for 10X scATAC-seq data, users can run the following script to prepare the project:\n\n    from APEC import convert\n    convert.convert_10X('$10X_data_folder/', '$project/')\n\nThe '$10X_data_folder' should contain 'barcodes.tsv', 'matrix.mtx' and 'peaks.bed' files, which are the results of Cellranger.\n\nIf using the matrix generated from other experiments, users need to prepare a project folder (termed '$project'), which contains **matrix** and **peak** folders. Please place \"filtered_cells.csv\" and \"filtered_reads.mtx\" in **matrix** folder, \"top_filtered_peaks.bed\" in **peak** folder. Here is the instruction for three input files:\n\n    filtered_cells.csv: Two-column (separated by tabs) list of cell information ('name' and 'notes'):\n                        The 'name' column stores cell names (or barcodes).\n                        The 'notes' column can be cell-type or any other cell information.\n    top_filtered_peaks.bed: Three-column list of peaks, which is a standard bed format file.\n                            It is same to the \"peaks.bed\" file in the CellRanger output of a 10X dataset.\n    filtered_reads.mtx: Fragment count matrix in mtx format, where a row is a peak and a column is a cell.\n                        It is same to the \"matrix.mtx\" file in the CellRanger output of a 10X dataset.\n                        The order of cells should be the same with \"filtered_cells.csv\".\n                        The order of peaks should be the same with \"top_filtered_peaks.bed.\n\n\n### 3. Functions of APEC (step by step)\n\n#### Users can directly run example projects and scripts in \"examples\" folder to generate figures listed in our APEC paper (https://www.biorxiv.org/content/10.1101/646331v4).\n\n#### 3.1 Clustering by APEC\n\nUse the following codes to cluster cells by APEC algorithm:\n\n    clustering.build_accesson('$project', ngroup=600)\n    clustering.cluster_byAccesson('$project', nc=0, norm='probability')\n    plot.plot_tsne('$project', rs=0)\n    plot.correlation('$project', cell_label='notes', clip=[0,1])\n\ninput parameters:\n\n    ngroup:   Number of accessons, default=600.\n    nc:       Number of cell clusters, set it to 0 if users want to predict it with APEC, default=0.\n    norm:     Normalization method, can be 'zscore', 'probability', or 'filter'; default='probability'.\n              If there are many noises in the fragment count matrix, please consider to set norm='filter'.\n    rs:             The random_seed parameter for tSNE, default=0.\n    cell_label:     Color labels for cells, can be 'notes' or 'cluster', default='notes'.\n                    If cell_label='cluster', it will use clustering result of clustering.cluster_byAccesson().\n    clip:           Range [min, max] for the correlation heatmap, default=[-1,1]\n\noutput files:\n\n    $project/matrix/Accesson_peaks.csv\n    $project/matrix/Accesson_reads.csv\n    $project/result/cluster_by_APEC.csv\n    $project/result/TSNE_by_APEC.csv\n    $project/figure/TSNE_by_APEC_with_notes_label.pdf\n    $project/figure/TSNE_by_APEC_with_cluster_label.pdf\n    $project/figure/cell_cell_correlation_by_APEC_with_notes_label.png\n\n<img src=\"images/TSNE_by_APEC_with_notes_label.jpg\" width=\"400\">\n\n_Figure A. TSNE_by_APEC_with_notes_label.pdf, where cells are labeled with cell types (the 'notes' column of filtered_cells.csv)_\n\n<img src=\"images/TSNE_by_APEC_with_cluster_label.jpg\" width=\"400\">\n\n_Figure B. TSNE_by_APEC_with_cluster_label.pdf, where cells are labeled with cell clusters (the 'cluster' column of cluster_by_APEC.csv)_\n\n#### 3.2 Clustering by chromVAR (optional, required for motif analysis)\n\nUse the following codes to cluster cells by chromVAR algorithm:\n\n    generate.motif_matrix('$project', genome_fa='$reference/hg19_chr.fa',\n                          background='$reference/tier1_markov1.norc.txt',\n                          meme='$reference/JASPAR2018_CORE_vertebrates_redundant_pfms_meme.txt',\n                          np=4)\n    clustering.cluster_byMotif('$project', np=4, nc=0, ns=50)\n\ninput parameters:\n\n    genome_fa:   Path to hg19_chr.fa or mm10_chr.fa in $reference folder.\n    background:  Path to tier1_markov1.norc.txt in $reference folder.\n    meme:        Path to JASPAR2018_CORE_vertebrates_redundant_pfms_meme.txt in $reference folder.\n    np:          Number of CPU cores used for parallel calculation, default=4.\n    nc:          Number of cell clusters, set it to 0 if users want to predict it using Louvain algorithm, default=0.\n    ns:          Number of permuted sampling, default=50.\n\noutput files:\n\n    $project/result/deviation_chromVAR.csv\n    $project/result/cluster_by_chromVAR.csv\n\n#### 3.3 Evaluate ARI, NMI and AMI for clustering result\n\nIf users have the real cell type in the 'notes' column of '$project/matrix/filtered_cells.csv', please use the following code to calculate ARI, NMI and AMI to estimate the accuracy of the clustering algorithm.\n\n    clustering.cluster_comparison('$project/matrix/filtered_cells.csv',\n                                  '$project/result/cluster_by_APEC.csv',\n                                  exclude='UNK')\n\nThe output ARI, NMI and AMI values will be printed on the screen directly. Please make sure that the column 'notes' of filtered_cells.csv denotes the cell type of each cell. For some datasets, such as the hematopoietic cells, the user should exclude all \"UNK\" cells (unknown type) before the calculation of ARI.\n\n#### 3.4 Generate pseudotime trajectory\n\nBy default, APEC adapts monocle to generate pseudotime trajectory from accesson matrix:\n\n    generate.monocle_trajectory('$project', npc=5)\n    plot.plot_trajectory('$project', cell_label='notes', angles=[30,30])\n\ninput parameters:\n\n    npc:            Number of principal components used to build trajectory, default=5.\n    cell_label:     Labels for cells, can be 'notes' or 'cluster', default='notes'.\n    angles:         Rotation angles for 3D trajectory, e.g. [100,20], default=[30,30].\n\noutput files:\n\n    $project/result/monocle_trajectory.csv\n    $project/result/monocle_reduced_dimension.csv\n    $project/figure/pseudotime_trajectory_with_notes_label.pdf\n\n<img src=\"images/pseudotime_trajectory_with_notes_label.jpg\" width=\"400\">\n\n_Figure C. pseudotime_trajectory_with_notes_label.pdf_\n\n#### 3.5 Generate gene expression\n\n    generate.gene_score('$project', genome_gtf='hg19_RefSeq_genes.gtf', distal=20000)\n\noutput file:\n\n    $project/matrix/genes_scored_by_TSS_peaks.csv\n    $project/peak/genes_TSS_peaks.csv\n\n#### 3.6 Generate differential feature for a cell cluster\n\nGet differential accessons:\n\n    generate.get_nearby_genes('$project')   # optional. Users should run step 3.5 before this.\n    generate.differential_feature('$project', feature='accesson', target='0', vs='all')\n\nGet differential motifs/genes:\n\n    generate.differential_feature('$project', feature='motif', target='0', vs='all')\n    generate.differential_feature('$project', feature='gene', target='0', vs='all')\n\ninput parameters:\n\n    feature:     Type of feature, can be 'accesson' or 'motif' or 'gene', default='accesson'.\n                 If feature='accesson', run step 3.1 first;\n                 if feature='motif', run step 3.2 first;\n                 if feature='gene', run step 3.5 first.\n    cell_label:  Cell Labels used for differential analysis, can be 'notes' or 'cluster', default='cluster'.\n    target:      The target cluster that users search for differential features, default='1'.\n                 If cell_label='cluster', target is one element in the 'cluster' column of cluster_by_APEC.csv file;\n                 if cell_label='notes', target is one element in the 'notes' column of filtered_cells.csv file.\n    vs:          Versus which clusters, can be '2,3,4' or 'all', default='all' (means all the rest clusters).\n    pvalue:      P-value for student-t test, default=0.01.\n    log2_fold:   Cutoff for log2(fold_change), default=1.\n\noutput file:\n\n    $project/result/differential_accesson_of_cluster_X_vs_XXX.csv\n    $project/result/differential_motif_of_cluster_X_vs_XXX.csv\n    $project/result/differential_gene_of_cluster_X_vs_XXX.csv\n\n#### 3.7 Plot motif/gene on tSNE/trajectory diagram\n\n    plot.plot_feature('$project', space='tsne', feature='gene', name='FOXO1')\n    plot.plot_feature('$project', space='trajectory', feature='motif', name='GATA1')\n\ninput parameters:\n\n    space:          In which space we draw the feature, can be 'tsne' or 'trajectory', default='tsne'.\n                    If space='tsne', run plot.plot_tsne() first;\n                    if space='trajectory', run step 3.4 first.\n    feature:        Type of the feature, can be 'accesson' or 'motif' or 'gene', default='accesson'.\n                    If feature='accesson', run step 3.1 first;\n                    if feature='motif', run step 3.2 first;\n                    if feature='gene', run step 3.5 first.\n    name:           Name of the feature.\n                    If feature='accesson', name=accesson number, i.e. '1';\n                    if feature='motif', name=motif symbol, i.e. 'GATA1';\n                    if feature='gene', name=gene symbol, i.e. 'CD36'.\n    clip:           Clip range for the input matrix, can be [min, max] or 'none', default='none'.\n    angles:         Rotation angles for 3D trajectory, e.g. [100,20], default=[30,30].\n\noutput files:\n\n    $project/figure/motif_XXX_on_trajectory_by_APEC.pdf\n    $project/figure/gene_XXX_on_tsne_by_APEC.pdf\n\n<img src=\"images/motif_GATA1_on_trajectory_by_APEC.jpg\" width=\"400\">\n\n_Figure D. motif_GATA1_on_trajectory_by_APEC.pdf_\n\n#### 3.8 Generate potential super enhancer\n\n    generate.super_enhancer('$project', super_range=1000000, p_cutoff=0.01)\n\ninput parameter:\n\n    super_range:    Genome range to search for super enhancer, default=1000000.\n    p_cutoff:       Cutoff of P-value, default=0.01.\n\noutput file:\n\n    $project/result/potential_super_enhancer.csv\n\n\n## Section Two. Get fragment count matrix from raw data\n### (This part is only available on GitHub:https://github.com/QuKunLab/APEC)\n\n### 1. Requirements and installation\n\nAll of the following software needs to be placed in the global environment of the Linux system to ensure that they can be called in any path/folder. Picard is also required, but we have placed it into $APEC/reference folder, and users don't need to install it. We recommend that users adopt the latest version of these software, except Meme (version 4.11.2).\n\n    Bowtie2: https://sourceforge.net/projects/bowtie-bio/files/bowtie2/2.2.9/\n    Samtools: https://github.com/samtools/samtools\n    Bedtools: http://bedtools.readthedocs.io/en/latest/content/installation.html\n    Macs2: https://github.com/taoliu/MACS.git\n    Meme 4.11.2: http://meme-suite.org/doc/download.html?man_type=web\n    pysam for python: set up by \"pip install pysam\"\n    Levenshtein for python: set up by \"pip install python-Levenshtein\"\n\n#### 1.2\tInstallation\n\nUsers can simply install this part by copying the **code_v1.2** folder and **reference** folder into a same path. Users **must** run ***APEC_prepare_steps.sh*** directly in code_v1.2/, since each program will invoke the reference files automatically. The **reference** folder is required, but we didn't upload reference files to GitHub since they are too big. Users can download all reference files from one of the following sites:\n\n-|website\n-|-\n1|http://galaxy.ustc.edu.cn:30803/APEC/reference/ <br> Due to server upgrades, this site will be temporarily unavailable from 2020-03-30 to 2020-04-01.\n2|https://apec.oss-us-east-1.aliyuncs.com/APEC/reference_full.zip.001 <br> https://apec.oss-us-east-1.aliyuncs.com/APEC/reference_full.zip.002 <br> https://apec.oss-us-east-1.aliyuncs.com/APEC/reference_full.zip.003\n\n The **reference** folder should contains the following files:\n\n    hg19_refseq_genes_TSS.txt, hg19_RefSeq_genes.gtf, hg19_blacklist.JDB.bed,\n    hg19_chr.fa, hg19_chr.fa.fai, hg19.chrom.sizes,\n    hg19.1.bt2, hg19.2.bt2, hg19.3.bt2, hg19.4.bt2, hg19.rev.1.bt2, hg19.rev.2.bt2,\n    mm10_refseq_genes_TSS.txt, mm10_RefSeq_genes.gtf, mm10_blacklist.BIN.bed,\n    mm10_chr.fa, mm10_chr.fa.fai, mm10.chrom.sizes,\n    mm10.1.bt2, mm10.2.bt2, mm10.3.bt2, mm10.4.bt2, mm10.rev.1.bt2, mm10.rev.2.bt2,\n    JASPAR2018_CORE_vertebrates_non-redundant_pfms_meme.txt, tier1_markov1.norc.txt, picard.jar\n\n### 2. Fragment count matrix\n\n#### 2.1\tArrangement of raw data\n\nThe **raw_data** folder should contain all raw sequencing fastq files into the. All these pair-end fastq files should be named as:\n\n    type1-001_1.fastq, type1-001_2.fastq, type1-002_1.fastq, type1-002_2.fastq, \u2026\u2026;\n    type2-001_1.fastq, type2-001_2.fastq, type2-002_1.fastq, type2-002_2.fastq, \u2026\u2026;\n    \u2026\u2026\n\nwhere \"\\_1\" and \"\\_2\" indicate forward and backward reads for pair-end sequencing. {type1, type2, ...} can be cell-types or batches of samples, such as {GM, K562, ...}, or {batch1, batch2, ...}, or any other words without underline \"\\_\" or dash \"-\".\nUsers need to build a **project** folder to store the result. The **work**, **matrix**, **peak** and **figure** folders will be automatically built by subsequent steps, and placed in **project** folder.\n\n#### 2.2\tEasy-run of matrix preparation\n\nUsers can use the script ***APEC_prepare_steps.sh*** to finish the process from raw data to fragment count matrix.  This script includes steps of \"trimming\", \"mapping\", \"peak calling\", \"aligning read counts matrix\", and \"quality contral\". Running this step on our example project (i.e. project01 with 672 cells) will take 10~20 hours on an 8-core 32 GB computer, since the sequence mapping step is the slowest step.\n\nExample:\n\n    bash APEC_prepare_steps.sh -r $raw_data -s $project -g hg19 -n 4 -l 3 -p 0.2 -f 2000\n\nInput parameters:\n\n    -r: The raw_data folder\n    -s: The project folder.\n    -g: \"hg19\" or \"mm10\".\n    -n: Number of CPU cores.\n    -l: Threshold for the \u2013log(Q-value) of peaks, used to filter peaks.\n    -p: Threshold of the percentage of fragments in peaks, used to filter cells.\n    -f: Threshold of the fragment number of each cell, used to filter cells.\n\nOutput files:\n\nThe script ***APEC_prepare_steps.sh*** will generate **work**, **peak**, **matrix**, and **figure** folders with many output files. Here, we only introduce files that are useful to users. For our example projects, all of these results can be reproduced on a general computer system.\n\n(1) In **work** folder:\n\nFor each cell, the mapping step can generate a subfolder (with cell name) in the **work** folder. There are several useful files in each subfolder:\n\n    cell_name.hist.pdf: A histogram of fragment length distribution of each cell.\n    cell_name.RefSeqTSS.pdf: Insert enrichment around TSS regions of each cell.\n\n(2) In **peak** folder:\n\n    mergeAll.hist.pdf: A histogram of fragment length distribution of all cells.\n    mergeAll.RefSeqTSS.pdf: Insert enrichment around TSS regions of all cells.\n    top_filtered_peaks.bed: Filtered top peaks, ranked by Q-value.\n\n(3) In **matrix** folder:\n\n    reads.csv: Fragment count matrix.\n    cell_info.merged.csv: Data quality report of each cell.\n    filtered_cells.csv: Filtered cells information in csv format.\n    filtered_reads.mtx: Filtered fragment count matrix in mtx format.\n\n(4) In **figure** folder:\n\n    cell_quality.pdf: A scatter plot of the fragment number and the percentage of fragments in peaks.\n\n### 3. Generate bigwig files for UCSC track\n\n    generate_UCSCtrack.py -s $project --cfile cluster.csv --gsize chrom.sizes\n\n    Options:\n      -s             The project folder.\n      --cfile        cluster.csv file, e.g. cluster_by_APEC.csv in\n                     $project/result/ folder\n      --gsize        chrom.size files, default=../reference/hg19.chrom.sizes\n\nThis script outputs bigwig files to $project/result/track/ folder.\n"
      },
      "source": "https://raw.githubusercontent.com/QuKunLab/APEC/master/README.md",
      "technique": "header_analysis"
    },
    {
      "confidence": 1,
      "result": {
        "original_header": "3. Generate bigwig files for UCSC track",
        "parent_header": [
          "User Guide for APEC (v1.2.2)",
          "Section Two. Get fragment count matrix from raw data"
        ],
        "type": "Text_excerpt",
        "value": "    generate_UCSCtrack.py -s $project --cfile cluster.csv --gsize chrom.sizes\n\n    Options:\n      -s             The project folder.\n      --cfile        cluster.csv file, e.g. cluster_by_APEC.csv in\n                     $project/result/ folder\n      --gsize        chrom.size files, default=../reference/hg19.chrom.sizes\n\nThis script outputs bigwig files to $project/result/track/ folder.\n"
      },
      "source": "https://raw.githubusercontent.com/QuKunLab/APEC/master/README.md",
      "technique": "header_analysis"
    }
  ]
}